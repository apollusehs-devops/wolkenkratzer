[![npm version](https://badge.fury.io/js/wolkenkratzer.svg)](https://badge.fury.io/js/wolkenkratzer)
[![Build Status](https://travis-ci.org/arminhammer/wolkenkratzer.svg?branch=master)](https://travis-ci.org/arminhammer/wolkenkratzer)
[![Coverage Status](https://coveralls.io/repos/github/arminhammer/wolkenkratzer/badge.svg?branch=master)](https://coveralls.io/github/arminhammer/wolkenkratzer?branch=master)

# Welcome to Wolkenkratzer!

Wolkenkratzer is a Javascript library that allows you to programmatically generate AWS CloudFormation templates. 

## Warning

The API for wolkenkratzer is not stable! There were many changes between the 0.6.0 and 0.7.0 releases. The API will continue to unstable until the 1.0 release. If you want to use wolkenkratzer make sure you lock the version you are using in your package.json so that your code doesn't break. The API documentation is currently lacking, but will be improved in the future.

The library targets 100% feature parity with CloudFormation. This is accomplished by scraping the public documentation and using that to build the data model. The scraper and json data model are in the cfn-doc-json-stubs project. Markdown documentation for the data model is available at doc.md.

Wolkenkratzer's API is designed around immutable Template objects, and action functions that take an existing Template object and return a new one, without mutating the existing one. This allows for techniques such as method chaining:

```javascript
const { Template, Output, S3, Ref } = require('wolkenkratzer');

let t = Template()
  .add(S3.Bucket('Bucket'))
  .add(Output('BucketName', { Value: Ref('Bucket') }));

console.log(JSON.stringify(t.build(), null, 2));
```

Results in:

```json
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "Bucket": {
      "Type": "AWS::S3::Bucket",
        "Properties": {}
    }
  },
  "Outputs": {
    "BucketName": {
      "Value": {
        "Ref": "Bucket"
      }
    }
  }
}
```

When adding resources to the template, you can optionally have an Output block and (string) Parameters created automatically in one call:

```javascript
const { Template, S3 } = require('wolkenkratzer');

let t = Template().add(S3.Bucket('Bucket'), {
  Output: true,
  Parameters: ['BucketName']
});

console.log(JSON.stringify(t.build(), null, 2));
```

Result:

```json
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "Bucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketName": { "Ref": "BucketS3BucketParam" }
      }
    }
  },
  "Parameters": {
    "BucketS3BucketParam": {
        "Type": "String"
    }
  },
  "Outputs": {
    "BucketS3BucketOutput": {
        "Value": {
            "Ref": "Bucket"
        },
        "Export": {
            "Name": {
                "Fn::Sub": "${AWS::StackName}-S3-Bucket-Bucket"
            }
        }
    }
  }
}
```

Wolkenkratzer will also do (rudimentary) template type validation, throwing an error if an incorrect value is provided.

# Examples

Please see the examples/ folder for real and tested examples on how to use the library.

# API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## Template

**Properties**

-   `kind` **`"Template"`** 
-   `AWSTemplateFormatVersion` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `Description` **(void | [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))?** 
-   `Parameters` **{}** 
-   `Mappings` **{}** 
-   `Conditions` **{}** 
-   `Resources` **{}** 
-   `Outputs` **{}** 
-   `add` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `remove` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `removeDescription` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `build` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `merge` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `import` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 

## Template

Template Interface

**Properties**

-   `kind` **`"Template"`** 
-   `AWSTemplateFormatVersion` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `Description` **(void | [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))?** 
-   `Parameters` **{}** 
-   `Mappings` **{}** 
-   `Conditions` **{}** 
-   `Resources` **{}** 
-   `Outputs` **{}** 
-   `add` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `remove` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `removeDescription` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `build` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `merge` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 
-   `import` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 

## Template

IAddOptions Interface

**Properties**

-   `Output` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 
-   `Parameters` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** 

## Template

Returns a new Template object.

Returns **ITemplate** ITemplate

## add

Add a new Parameter, Description, Output, Resource, Condition, or Mapping to the template. Returns a new Template with the element added. Does not mutate the original Template object.

**Parameters**

-   `e` **IElement** 
-   `options` **IAddOptions** 

**Examples**

```javascript
const t = Template().add(S3.Bucket('Bucket'), { Output: true });
```

Returns **ITemplate** 

## build

Returns a finished CloudFormation template object. This can then be converted into JSON or YAML.

**Examples**

```javascript
const t = Template();
JSON.stringify(t.build(), null, 2)
```

Returns **any** 

## remove

Remove a Parameter, Description, Output, Resource, Condition, or Mapping from the template. Returns a new Template with the element removed. Does not mutate the original Template object.

**Parameters**

-   `e` **(IElement | [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))** 

**Examples**

```javascript
let t = Template();
let p = Parameter('NewParam', { Type: 'String' });
t.add(p).remove(p);
```

Returns **ITemplate** 

## removeDescription

Removes the Description from the Template.

Returns **ITemplate** 

## merge

Merges another Template object into another. The original Template objects are not mutated. Returns a new Template object that is the product of the two original Template objects.

**Parameters**

-   `t` **ITemplate** 

Returns **ITemplate** 

## import

Import an existing CloudFormation JSON template and convert it into a Wolkenkratzer Template object.

**Parameters**

-   `inputTemplate` **any** 

**Examples**

```javascript
const templateJson = require('template.json');
const t = Template().import(templateJson);
```

Returns **ITemplate** 

## getInstanceTypeList

Returns an array of all instance types and details.

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

## getInstanceTypeNameList

Returns an array of just the instance type names available in AWS.

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

## getInstanceTypeMap

Returns a map of all instance types and details.

Returns **{}** 

## getRegions

Returns an array of the names of all regions in AWS.

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** 

## getAMIMap

Returns an AMI Map that can be added to a Mapping.

**Parameters**

-   `filters` **any** 
-   `regions` **any** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;TResult>** 
