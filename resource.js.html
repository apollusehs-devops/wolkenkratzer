<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: resource.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: resource.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by arming on 6/15/16.
 */
'use strict'
const RequiredPropertyException = require('./exceptions').RequiredPropertyException
const ConditionNotMetException = require('./exceptions').ConditionNotMetException
const TypeException = require('./exceptions').TypeException
const Policy = require('./policy').Policy

/** @module Core */

/**
 * @memberof module:Core
 * @property {String} WKName
 */
class WKResource {
  constructor (name, resourceType, properties, propertiesObject, conditional) {
    this.WKName = name
    this.WKResourceType = resourceType
    this.properties = properties
    this.conditional = conditional
    for (let prop in this.properties) {
      Object.defineProperty(this, prop, {
        set: (value) => {
          this.properties[prop].set(value)
        },
        get: () => {
          return this.properties[prop]
        }
      })
    }
    if (propertiesObject) {
      for (let prop in propertiesObject) {
        if(this.properties[prop]) {
          let property = propertiesObject[prop]
          if(typeof property === 'string') {
            property = new String(property)
          } else if(typeof property === 'boolean') {
            property = new Boolean(property)
          } else if(typeof property === 'number') {
            property = new Number(property)
          }
          if(this.properties[prop].Type) {
            if(property instanceof this.properties[prop].Type) {
            } else {
              try {
                property = new this.properties[prop].Type(property)
              } catch(e) {
              }
            }
            try {
              this.properties[prop].set(propertiesObject[prop])
            } catch (e) {
            }
          }
        }
      }
    }
  }
  dependsOn (resource) {
    this.dependsOn = resource
  }
  addConfig (config) {
    if(this instanceof require('./resources/ec2').Instance) {
      if(!this.Metadata) {
        this.Metadata = {
        }
      }
      if(!this.Metadata['AWS::CloudFormation::Init']) {
        this.Metadata['AWS::CloudFormation::Init'] = {
          configSets: {}
        }
      }
      this.Metadata['AWS::CloudFormation::Init'][config.WKName] = config
    } else {
      throw new TypeException('Not allowed to add ' + config + 'to ' + this.WKName + ' because it is not an Instance or LaunchConfiguration')
    }
  }
  addConfigSet (configSet) {
    if(this instanceof require('./resources/ec2').Instance) {
      if(!this.Metadata) {
        this.Metadata = {
        }
      }
      if(!this.Metadata['AWS::CloudFormation::Init']) {
        this.Metadata['AWS::CloudFormation::Init'] = {
          configSets: {}
        }
      }
      this.Metadata['AWS::CloudFormation::Init'].configSets[configSet.WKName] = configSet.configs
    } else {
      throw new TypeException('Not allowed to add ' + configSet + 'to ' + this.WKName + ' because it is not an Instance or LaunchConfiguration')
    }
  }
  addPolicy (policy) {
    if(!this.policies) {
      this.policies = {}
    }
    if(policy instanceof Policy) {
      this.policies[policy.WKName] = policy
    } else {
      throw new TypeException(policy + ' must be of type Policy')
    }
  }
  /**
   * Performs validation and returns a pretty-printed JSON object.
   * @returns {String}
   */
  toJson () {
    let newProperties = JSON.parse(JSON.stringify(this.properties))
    for (let prop in newProperties) {
      try {
        newProperties[prop] = this.properties[prop].toJson()
      } catch (e) {
        if (e instanceof RequiredPropertyException) {
          throw new RequiredPropertyException(this.WKName + '.' + prop + ' or a subproperty is required but not defined: ' + e.message)
        }
      }
    }
    if(this.conditional) {
      try {
        this.conditional(this.properties)
      } catch (e) {
        if (e instanceof ConditionNotMetException) {
          throw new ConditionNotMetException(this.WKName + ' has a condition that was not met: ' + e.message)
        }
      }
    }
    let newMetadata = {}
    if(this.Metadata) {
      if(this.Metadata['AWS::CloudFormation::Init']) {
        newMetadata['AWS::CloudFormation::Init'] = {}
        for (let config in this.Metadata['AWS::CloudFormation::Init']) {
          if(config === 'configSets') {
            newMetadata['AWS::CloudFormation::Init'][config] = this.Metadata['AWS::CloudFormation::Init'][config]
          } else {
            newMetadata['AWS::CloudFormation::Init'][config] = this.Metadata['AWS::CloudFormation::Init'][config].toJson()
          }
        }
      }
    }
    let returnObject = {
      Type: this.WKResourceType,
      Properties: newProperties,
    }
    if(this.Metadata) {
      returnObject.Metadata = newMetadata
    }
    if(this.policies) {
      for(let policy in this.policies) {
        returnObject[policy] = this.policies[policy].toJson()
      }
    }
    if (this.dependsOn) {
      returnObject.DependsOn = this.dependsOn.WKName
    }
    return returnObject
  }
}

/**
 * @memberof module:Core
 */
class ResourceProperty {
  constructor (name, properties, propertiesObject, conditional) {
    this.WKName = name
    this.properties = properties
    this.conditional = conditional
    for (let prop in this.properties) {
      Object.defineProperty(this, prop, {
        set: (value) => {
          this.properties[prop].set(value)
        },
        get: () => {
          return this.properties[prop]
        }
      })
    }
    if (propertiesObject) {
      for (let prop in propertiesObject) {
        this.properties[prop] = propertiesObject[prop]
      }
    }
  }
  toJson() {
    let newProperties = JSON.parse(JSON.stringify(this.properties))
    for (let prop in newProperties) {
      try {
        newProperties[prop] = this.properties[prop].toJson()
      } catch (e) {
        if (e instanceof RequiredPropertyException) {
          throw new RequiredPropertyException(this.WKName + '.' + prop + ' is required but not defined: ' + e.message)
        }
      }
    }
    if(this.conditional) {
      try {
        this.conditional(this.properties)
      } catch (e) {
        if (e instanceof ConditionNotMetException) {
          throw new ConditionNotMetException(this.WKName + ' has a condition that was not met: ' + e.message)
        }
      }
    }
    return newProperties
  }
}

module.exports = {
  WKResource: WKResource,
  ResourceProperty: ResourceProperty
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ApiGateway.html">ApiGateway</a></li><li><a href="module-AutoScaling.html">AutoScaling</a></li><li><a href="module-CloudFormation.html">CloudFormation</a></li><li><a href="module-CloudFront.html">CloudFront</a></li><li><a href="module-CloudTrail.html">CloudTrail</a></li><li><a href="module-CloudWatch.html">CloudWatch</a></li><li><a href="module-CodeDeploy.html">CodeDeploy</a></li><li><a href="module-CodePipeline.html">CodePipeline</a></li><li><a href="module-Config.html">Config</a></li><li><a href="module-Core.html">Core</a></li><li><a href="module-DataPipeline.html">DataPipeline</a></li><li><a href="module-DirectoryService.html">DirectoryService</a></li><li><a href="module-DynamoDB.html">DynamoDB</a></li><li><a href="module-EC2.html">EC2</a></li><li><a href="module-ECR.html">ECR</a></li><li><a href="module-ECS.html">ECS</a></li><li><a href="module-EFS.html">EFS</a></li><li><a href="module-ElastiCache.html">ElastiCache</a></li><li><a href="module-ElasticBeanstalk.html">ElasticBeanstalk</a></li><li><a href="module-ElasticLoadBalancing.html">ElasticLoadBalancing</a></li><li><a href="module-Elasticsearch.html">Elasticsearch</a></li><li><a href="module-EMR.html">EMR</a></li><li><a href="module-Events.html">Events</a></li><li><a href="module-GameLift.html">GameLift</a></li><li><a href="module-IAM.html">IAM</a></li><li><a href="module-Kinesis.html">Kinesis</a></li><li><a href="module-KinesisFirehose.html">KinesisFirehose</a></li><li><a href="module-KMS.html">KMS</a></li><li><a href="module-Lambda.html">Lambda</a></li><li><a href="module-Logs.html">Logs</a></li><li><a href="module-OpsWorks.html">OpsWorks</a></li><li><a href="module-RDS.html">RDS</a></li><li><a href="module-Redshift.html">Redshift</a></li><li><a href="module-Route53.html">Route53</a></li><li><a href="module-S3.html">S3</a></li><li><a href="module-SDB.html">SDB</a></li><li><a href="module-SNS.html">SNS</a></li><li><a href="module-SQS.html">SQS</a></li><li><a href="module-SSM.html">SSM</a></li><li><a href="module-WAF.html">WAF</a></li><li><a href="module-WorkSpaces.html">WorkSpaces</a></li></ul><h3>Classes</h3><ul><li><a href="module-ApiGateway.Account.html">Account</a></li><li><a href="module-ApiGateway.ApiKey.html">ApiKey</a></li><li><a href="module-ApiGateway.Authorizer.html">Authorizer</a></li><li><a href="module-ApiGateway.BasePathMapping.html">BasePathMapping</a></li><li><a href="module-ApiGateway.ClientCertificate.html">ClientCertificate</a></li><li><a href="module-ApiGateway.Deployment.html">Deployment</a></li><li><a href="module-ApiGateway.Method.html">Method</a></li><li><a href="module-ApiGateway.Model.html">Model</a></li><li><a href="module-ApiGateway.Resource.html">Resource</a></li><li><a href="module-ApiGateway.RestApi.html">RestApi</a></li><li><a href="module-ApiGateway.Stage.html">Stage</a></li><li><a href="module-AutoScaling.AutoScalingGroup.html">AutoScalingGroup</a></li><li><a href="module-AutoScaling.LaunchConfiguration.html">LaunchConfiguration</a></li><li><a href="module-AutoScaling.LifecycleHook.html">LifecycleHook</a></li><li><a href="module-AutoScaling.ScalingPolicy.html">ScalingPolicy</a></li><li><a href="module-AutoScaling.ScheduledAction.html">ScheduledAction</a></li><li><a href="module-CloudFormation.Authentication.html">Authentication</a></li><li><a href="module-CloudFormation.CustomResource.html">CustomResource</a></li><li><a href="module-CloudFormation.Init.html">Init</a></li><li><a href="module-CloudFormation.Interface.html">Interface</a></li><li><a href="module-CloudFormation.Stack.html">Stack</a></li><li><a href="module-CloudFormation.WaitCondition.html">WaitCondition</a></li><li><a href="module-CloudFormation.WaitConditionHandle.html">WaitConditionHandle</a></li><li><a href="module-CloudFront.Distribution.html">Distribution</a></li><li><a href="module-CloudTrail.Trail.html">Trail</a></li><li><a href="module-CloudWatch.Alarm.html">Alarm</a></li><li><a href="module-CodeDeploy.Application.html">Application</a></li><li><a href="module-CodeDeploy.DeploymentConfig.html">DeploymentConfig</a></li><li><a href="module-CodeDeploy.DeploymentGroup.html">DeploymentGroup</a></li><li><a href="module-CodePipeline.CustomActionType.html">CustomActionType</a></li><li><a href="module-CodePipeline.Pipeline.html">Pipeline</a></li><li><a href="module-Config.ConfigRule.html">ConfigRule</a></li><li><a href="module-Config.ConfigurationRecorder.html">ConfigurationRecorder</a></li><li><a href="module-Config.DeliveryChannel.html">DeliveryChannel</a></li><li><a href="module-Core.ResourceProperty.html">ResourceProperty</a></li><li><a href="module-Core.WKResource.html">WKResource</a></li><li><a href="module-DataPipeline.Pipeline.html">Pipeline</a></li><li><a href="module-DirectoryService.MicrosoftAD.html">MicrosoftAD</a></li><li><a href="module-DirectoryService.SimpleAD.html">SimpleAD</a></li><li><a href="module-DynamoDB.Table.html">Table</a></li><li><a href="module-EC2.CustomerGateway.html">CustomerGateway</a></li><li><a href="module-EC2.DHCPOptions.html">DHCPOptions</a></li><li><a href="module-EC2.EIP.html">EIP</a></li><li><a href="module-EC2.EIPAssociation.html">EIPAssociation</a></li><li><a href="module-EC2.FlowLog.html">FlowLog</a></li><li><a href="module-EC2.Host.html">Host</a></li><li><a href="module-EC2.Instance.html">Instance</a></li><li><a href="module-EC2.InternetGateway.html">InternetGateway</a></li><li><a href="module-EC2.NatGateway.html">NatGateway</a></li><li><a href="module-EC2.NetworkAcl.html">NetworkAcl</a></li><li><a href="module-EC2.NetworkAclEntry.html">NetworkAclEntry</a></li><li><a href="module-EC2.NetworkInterface.html">NetworkInterface</a></li><li><a href="module-EC2.NetworkInterfaceAttachment.html">NetworkInterfaceAttachment</a></li><li><a href="module-EC2.PlacementGroup.html">PlacementGroup</a></li><li><a href="module-EC2.Route.html">Route</a></li><li><a href="module-EC2.RouteTable.html">RouteTable</a></li><li><a href="module-EC2.SecurityGroup.html">SecurityGroup</a></li><li><a href="module-EC2.SecurityGroupEgress.html">SecurityGroupEgress</a></li><li><a href="module-EC2.SecurityGroupIngress.html">SecurityGroupIngress</a></li><li><a href="module-EC2.SpotFleet.html">SpotFleet</a></li><li><a href="module-EC2.Subnet.html">Subnet</a></li><li><a href="module-EC2.SubnetNetworkAclAssociation.html">SubnetNetworkAclAssociation</a></li><li><a href="module-EC2.SubnetRouteTableAssociation.html">SubnetRouteTableAssociation</a></li><li><a href="module-EC2.Volume.html">Volume</a></li><li><a href="module-EC2.VolumeAttachment.html">VolumeAttachment</a></li><li><a href="module-EC2.VPC.html">VPC</a></li><li><a href="module-EC2.VPCDHCPOptionsAssociation.html">VPCDHCPOptionsAssociation</a></li><li><a href="module-EC2.VPCEndpoint.html">VPCEndpoint</a></li><li><a href="module-EC2.VPCGatewayAttachment.html">VPCGatewayAttachment</a></li><li><a href="module-EC2.VPCPeeringConnection.html">VPCPeeringConnection</a></li><li><a href="module-EC2.VPNConnection.html">VPNConnection</a></li><li><a href="module-EC2.VPNConnectionRoute.html">VPNConnectionRoute</a></li><li><a href="module-EC2.VPNGateway.html">VPNGateway</a></li><li><a href="module-EC2.VPNGatewayRoutePropagation.html">VPNGatewayRoutePropagation</a></li><li><a href="module-ECR.Repository.html">Repository</a></li><li><a href="module-ECS.Cluster.html">Cluster</a></li><li><a href="module-ECS.Service.html">Service</a></li><li><a href="module-ECS.TaskDefinition.html">TaskDefinition</a></li><li><a href="module-EFS.FileSystem.html">FileSystem</a></li><li><a href="module-EFS.MountTarget.html">MountTarget</a></li><li><a href="module-ElastiCache.CacheCluster.html">CacheCluster</a></li><li><a href="module-ElastiCache.ParameterGroup.html">ParameterGroup</a></li><li><a href="module-ElastiCache.ReplicationGroup.html">ReplicationGroup</a></li><li><a href="module-ElastiCache.SecurityGroup.html">SecurityGroup</a></li><li><a href="module-ElastiCache.SecurityGroupIngress.html">SecurityGroupIngress</a></li><li><a href="module-ElastiCache.SubnetGroup.html">SubnetGroup</a></li><li><a href="module-ElasticBeanstalk.Application.html">Application</a></li><li><a href="module-ElasticBeanstalk.ApplicationVersion.html">ApplicationVersion</a></li><li><a href="module-ElasticBeanstalk.ConfigurationTemplate.html">ConfigurationTemplate</a></li><li><a href="module-ElasticBeanstalk.Environment.html">Environment</a></li><li><a href="module-ElasticLoadBalancing.LoadBalancer.html">LoadBalancer</a></li><li><a href="module-Elasticsearch.Domain.html">Domain</a></li><li><a href="module-EMR.Cluster.html">Cluster</a></li><li><a href="module-EMR.InstanceGroupConfig.html">InstanceGroupConfig</a></li><li><a href="module-EMR.Step.html">Step</a></li><li><a href="module-Events.Rule.html">Rule</a></li><li><a href="module-GameLift.Alias.html">Alias</a></li><li><a href="module-GameLift.Build.html">Build</a></li><li><a href="module-GameLift.Fleet.html">Fleet</a></li><li><a href="module-IAM.AccessKey.html">AccessKey</a></li><li><a href="module-IAM.Group.html">Group</a></li><li><a href="module-IAM.InstanceProfile.html">InstanceProfile</a></li><li><a href="module-IAM.ManagedPolicy.html">ManagedPolicy</a></li><li><a href="module-IAM.Policy.html">Policy</a></li><li><a href="module-IAM.Role.html">Role</a></li><li><a href="module-IAM.User.html">User</a></li><li><a href="module-IAM.UserToGroupAddition.html">UserToGroupAddition</a></li><li><a href="module-Kinesis.Stream.html">Stream</a></li><li><a href="module-KinesisFirehose.DeliveryStream.html">DeliveryStream</a></li><li><a href="module-KMS.Key.html">Key</a></li><li><a href="module-Lambda.Alias.html">Alias</a></li><li><a href="module-Lambda.EventSourceMapping.html">EventSourceMapping</a></li><li><a href="module-Lambda.LambdaFunction.html">LambdaFunction</a></li><li><a href="module-Lambda.Permission.html">Permission</a></li><li><a href="module-Lambda.Version.html">Version</a></li><li><a href="module-Logs.Destination.html">Destination</a></li><li><a href="module-Logs.LogGroup.html">LogGroup</a></li><li><a href="module-Logs.LogStream.html">LogStream</a></li><li><a href="module-Logs.MetricFilter.html">MetricFilter</a></li><li><a href="module-Logs.SubscriptionFilter.html">SubscriptionFilter</a></li><li><a href="module-OpsWorks.App.html">App</a></li><li><a href="module-OpsWorks.ElasticLoadBalancerAttachment.html">ElasticLoadBalancerAttachment</a></li><li><a href="module-OpsWorks.Instance.html">Instance</a></li><li><a href="module-OpsWorks.Layer.html">Layer</a></li><li><a href="module-OpsWorks.Stack.html">Stack</a></li><li><a href="module-RDS.DBCluster.html">DBCluster</a></li><li><a href="module-RDS.DBClusterParameterGroup.html">DBClusterParameterGroup</a></li><li><a href="module-RDS.DBInstance.html">DBInstance</a></li><li><a href="module-RDS.DBParameterGroup.html">DBParameterGroup</a></li><li><a href="module-RDS.DBSecurityGroup.html">DBSecurityGroup</a></li><li><a href="module-RDS.DBSecurityGroupIngress.html">DBSecurityGroupIngress</a></li><li><a href="module-RDS.DBSubnetGroup.html">DBSubnetGroup</a></li><li><a href="module-RDS.EventSubscription.html">EventSubscription</a></li><li><a href="module-RDS.OptionGroup.html">OptionGroup</a></li><li><a href="module-Redshift.Cluster.html">Cluster</a></li><li><a href="module-Redshift.ClusterParameterGroup.html">ClusterParameterGroup</a></li><li><a href="module-Redshift.ClusterSecurityGroup.html">ClusterSecurityGroup</a></li><li><a href="module-Redshift.ClusterSecurityGroupIngress.html">ClusterSecurityGroupIngress</a></li><li><a href="module-Redshift.ClusterSubnetGroup.html">ClusterSubnetGroup</a></li><li><a href="module-Route53.HealthCheck.html">HealthCheck</a></li><li><a href="module-Route53.HostedZone.html">HostedZone</a></li><li><a href="module-Route53.RecordSet.html">RecordSet</a></li><li><a href="module-Route53.RecordSetGroup.html">RecordSetGroup</a></li><li><a href="module-S3.Bucket.html">Bucket</a></li><li><a href="module-S3.BucketPolicy.html">BucketPolicy</a></li><li><a href="module-SDB.Domain.html">Domain</a></li><li><a href="module-SNS.Topic.html">Topic</a></li><li><a href="module-SNS.TopicPolicy.html">TopicPolicy</a></li><li><a href="module-SQS.Queue.html">Queue</a></li><li><a href="module-SQS.QueuePolicy.html">QueuePolicy</a></li><li><a href="module-SSM.Document.html">Document</a></li><li><a href="module-WAF.ByteMatchSet.html">ByteMatchSet</a></li><li><a href="module-WAF.IPSet.html">IPSet</a></li><li><a href="module-WAF.Rule.html">Rule</a></li><li><a href="module-WAF.SizeConstraintSet.html">SizeConstraintSet</a></li><li><a href="module-WAF.SqlInjectionMatchSet.html">SqlInjectionMatchSet</a></li><li><a href="module-WAF.WebACL.html">WebACL</a></li><li><a href="module-WAF.XssMatchSet.html">XssMatchSet</a></li><li><a href="module-WorkSpaces.Workspace.html">Workspace</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Jul 10 2016 01:10:15 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
