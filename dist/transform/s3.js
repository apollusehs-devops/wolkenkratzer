

'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.




S3BucketTransform = S3BucketTransform;var _service = require('../service');const s3Json = require('../stubs/json/S3.json');const s3Service = (0, _service.Service)(s3Json);function S3BucketTransform(
bucketName,
logicalName,
awsObj)
{
  const s3Client = new awsObj.S3();
  return new Promise((resolve, reject) => {
    //let bucket = new s3Resource.Bucket(newName);
    const bucket = {};
    return (
      s3Client.
      getBucketVersioning({ Bucket: bucketName }).
      promise().
      then(versionData => {
        if (Object.keys(versionData)) {
          bucket.VersioningConfiguration = versionData;
        }
        // return s3Client.getBucketAcl({ Bucket: bucketName }).promise()
        return s3Client.getBucketCors({ Bucket: bucketName }).promise();
      })
      /* .then(function (aclData) {
         console.log('2')
         console.log(JSON.stringify(aclData))
         bucket.AccessControl = aclData
         })*/.
      then(corsData => {
        console.log('cors');
        bucket.CorsConfiguration = corsData;
        return s3Client.
        getBucketLifecycleConfiguration({ Bucket: bucketName }).
        promise();
      }).
      catch(e => {
        // Silently catch the NoSuchCORSConfiguration
        return s3Client.
        getBucketLifecycleConfiguration({ Bucket: bucketName }).
        promise();
      }).
      then(lifeData => {
        console.log('life');
        bucket.LifecycleConfiguration = lifeData;
        return s3Client.getBucketLogging({ Bucket: bucketName }).promise();
      }).
      catch(e => {
        // Silently catch the NoSuchLifecycleConfiguration
        return s3Client.getBucketLogging({ Bucket: bucketName }).promise();
      }).
      then(loggingData => {
        bucket.LoggingConfiguration = {
          DestinationBucketName: loggingData.LoggingEnabled.TargetBucket,
          LogFilePrefix: loggingData.LoggingEnabled.TargetPrefix };

        return s3Client.
        getBucketNotification({ Bucket: bucketName }).
        promise();
      }).
      then(notificationData => {
        if (Object.keys(notificationData).length > 0) {
          bucket.NotificationConfiguration = notificationData;
        }
        return s3Client.
        getBucketReplication({ Bucket: bucketName }).
        promise();
      }).
      then(replData => {
        bucket.ReplicationConfiguration = replData;
        return s3Client.getBucketTagging({ Bucket: bucketName }).promise();
      }).
      then(tagsData => {
        tagsData.TagSet.forEach(tag => {
          bucket.Tags.add(tag);
        });
        return s3Client.getBucketWebsite({ Bucket: bucketName }).promise();
      }).
      catch(e => {
        // Silently catch the NoSuchTagSet
        return s3Client.getBucketWebsite({ Bucket: bucketName }).promise();
      }).
      then(websiteData => {
        bucket.WebsiteConfiguration = new websiteData();
      }).
      catch(e => {
        // Silently catch the NoSuchWebsiteConfiguration
        return;
      }).
      then(() => {
        resolve(s3Service.Bucket(logicalName, bucket));
      }).
      catch(e => {
        // Silently catch the NoSuchWebsiteConfiguration
        reject(e);
      }));

  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90cmFuc2Zvcm0vczMuanMiXSwibmFtZXMiOlsiUzNCdWNrZXRUcmFuc2Zvcm0iLCJzM0pzb24iLCJyZXF1aXJlIiwiczNTZXJ2aWNlIiwiYnVja2V0TmFtZSIsImxvZ2ljYWxOYW1lIiwiYXdzT2JqIiwiczNDbGllbnQiLCJTMyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiYnVja2V0IiwiZ2V0QnVja2V0VmVyc2lvbmluZyIsIkJ1Y2tldCIsInByb21pc2UiLCJ0aGVuIiwidmVyc2lvbkRhdGEiLCJPYmplY3QiLCJrZXlzIiwiVmVyc2lvbmluZ0NvbmZpZ3VyYXRpb24iLCJnZXRCdWNrZXRDb3JzIiwiY29yc0RhdGEiLCJjb25zb2xlIiwibG9nIiwiQ29yc0NvbmZpZ3VyYXRpb24iLCJnZXRCdWNrZXRMaWZlY3ljbGVDb25maWd1cmF0aW9uIiwiY2F0Y2giLCJlIiwibGlmZURhdGEiLCJMaWZlY3ljbGVDb25maWd1cmF0aW9uIiwiZ2V0QnVja2V0TG9nZ2luZyIsImxvZ2dpbmdEYXRhIiwiTG9nZ2luZ0NvbmZpZ3VyYXRpb24iLCJEZXN0aW5hdGlvbkJ1Y2tldE5hbWUiLCJMb2dnaW5nRW5hYmxlZCIsIlRhcmdldEJ1Y2tldCIsIkxvZ0ZpbGVQcmVmaXgiLCJUYXJnZXRQcmVmaXgiLCJnZXRCdWNrZXROb3RpZmljYXRpb24iLCJub3RpZmljYXRpb25EYXRhIiwibGVuZ3RoIiwiTm90aWZpY2F0aW9uQ29uZmlndXJhdGlvbiIsImdldEJ1Y2tldFJlcGxpY2F0aW9uIiwicmVwbERhdGEiLCJSZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb24iLCJnZXRCdWNrZXRUYWdnaW5nIiwidGFnc0RhdGEiLCJUYWdTZXQiLCJmb3JFYWNoIiwidGFnIiwiVGFncyIsImFkZCIsImdldEJ1Y2tldFdlYnNpdGUiLCJ3ZWJzaXRlRGF0YSIsIldlYnNpdGVDb25maWd1cmF0aW9uIl0sIm1hcHBpbmdzIjoiOztBQUVBLGE7Ozs7O0FBS2dCQSxpQixHQUFB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LFNBQVM4QyxnQkFBVCxDQUEwQixFQUFFdkMsUUFBUVYsVUFBVixFQUExQixFQUFrRFcsT0FBbEQsRUFBUDtBQUNELE9BL0RIO0FBZ0VHWSxXQWhFSCxDQWdFU0MsS0FBSztBQUNWO0FBQ0EsZUFBT3JCLFNBQVM4QyxnQkFBVCxDQUEwQixFQUFFdkMsUUFBUVYsVUFBVixFQUExQixFQUFrRFcsT0FBbEQsRUFBUDtBQUNELE9BbkVIO0FBb0VHQyxVQXBFSCxDQW9FUXNDLGVBQWU7QUFDbkIxQyxlQUFPMkMsb0JBQVAsR0FBOEIsSUFBSUQsV0FBSixFQUE5QjtBQUNELE9BdEVIO0FBdUVHM0IsV0F2RUgsQ0F1RVNDLEtBQUs7QUFDVjtBQUNBO0FBQ0QsT0ExRUg7QUEyRUdaLFVBM0VILENBMkVRLE1BQU07QUFDVk4sZ0JBQVFQLFVBQVVXLE1BQVYsQ0FBaUJULFdBQWpCLEVBQThCTyxNQUE5QixDQUFSO0FBQ0QsT0E3RUg7QUE4RUdlLFdBOUVILENBOEVTQyxLQUFLO0FBQ1Y7QUFDQWpCLGVBQU9pQixDQUFQO0FBQ0QsT0FqRkgsQ0FERjs7QUFvRkQsR0F2Rk0sQ0FBUDtBQXdGRCIsImZpbGUiOiJzMy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5cbid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlJztcbmNvbnN0IHMzSnNvbiA9IHJlcXVpcmUoJy4uL3N0dWJzL2pzb24vUzMuanNvbicpO1xuY29uc3QgczNTZXJ2aWNlOiBhbnkgPSBTZXJ2aWNlKHMzSnNvbik7XG5cbmV4cG9ydCBmdW5jdGlvbiBTM0J1Y2tldFRyYW5zZm9ybShcbiAgYnVja2V0TmFtZTogc3RyaW5nLFxuICBsb2dpY2FsTmFtZTogc3RyaW5nLFxuICBhd3NPYmo6IGFueVxuKSB7XG4gIGNvbnN0IHMzQ2xpZW50ID0gbmV3IGF3c09iai5TMygpO1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIC8vbGV0IGJ1Y2tldCA9IG5ldyBzM1Jlc291cmNlLkJ1Y2tldChuZXdOYW1lKTtcbiAgICBjb25zdCBidWNrZXQ6IGFueSA9IHt9O1xuICAgIHJldHVybiAoXG4gICAgICBzM0NsaWVudFxuICAgICAgICAuZ2V0QnVja2V0VmVyc2lvbmluZyh7IEJ1Y2tldDogYnVja2V0TmFtZSB9KVxuICAgICAgICAucHJvbWlzZSgpXG4gICAgICAgIC50aGVuKHZlcnNpb25EYXRhID0+IHtcbiAgICAgICAgICBpZiAoT2JqZWN0LmtleXModmVyc2lvbkRhdGEpKSB7XG4gICAgICAgICAgICBidWNrZXQuVmVyc2lvbmluZ0NvbmZpZ3VyYXRpb24gPSB2ZXJzaW9uRGF0YTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gcmV0dXJuIHMzQ2xpZW50LmdldEJ1Y2tldEFjbCh7IEJ1Y2tldDogYnVja2V0TmFtZSB9KS5wcm9taXNlKClcbiAgICAgICAgICByZXR1cm4gczNDbGllbnQuZ2V0QnVja2V0Q29ycyh7IEJ1Y2tldDogYnVja2V0TmFtZSB9KS5wcm9taXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC8qIC50aGVuKGZ1bmN0aW9uIChhY2xEYXRhKSB7XG4gICAgICBjb25zb2xlLmxvZygnMicpXG4gICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShhY2xEYXRhKSlcbiAgICAgIGJ1Y2tldC5BY2Nlc3NDb250cm9sID0gYWNsRGF0YVxuICAgIH0pKi9cbiAgICAgICAgLnRoZW4oY29yc0RhdGEgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdjb3JzJyk7XG4gICAgICAgICAgYnVja2V0LkNvcnNDb25maWd1cmF0aW9uID0gY29yc0RhdGE7XG4gICAgICAgICAgcmV0dXJuIHMzQ2xpZW50XG4gICAgICAgICAgICAuZ2V0QnVja2V0TGlmZWN5Y2xlQ29uZmlndXJhdGlvbih7IEJ1Y2tldDogYnVja2V0TmFtZSB9KVxuICAgICAgICAgICAgLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGUgPT4ge1xuICAgICAgICAgIC8vIFNpbGVudGx5IGNhdGNoIHRoZSBOb1N1Y2hDT1JTQ29uZmlndXJhdGlvblxuICAgICAgICAgIHJldHVybiBzM0NsaWVudFxuICAgICAgICAgICAgLmdldEJ1Y2tldExpZmVjeWNsZUNvbmZpZ3VyYXRpb24oeyBCdWNrZXQ6IGJ1Y2tldE5hbWUgfSlcbiAgICAgICAgICAgIC5wcm9taXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKGxpZmVEYXRhID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnbGlmZScpO1xuICAgICAgICAgIGJ1Y2tldC5MaWZlY3ljbGVDb25maWd1cmF0aW9uID0gbGlmZURhdGE7XG4gICAgICAgICAgcmV0dXJuIHMzQ2xpZW50LmdldEJ1Y2tldExvZ2dpbmcoeyBCdWNrZXQ6IGJ1Y2tldE5hbWUgfSkucHJvbWlzZSgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgLy8gU2lsZW50bHkgY2F0Y2ggdGhlIE5vU3VjaExpZmVjeWNsZUNvbmZpZ3VyYXRpb25cbiAgICAgICAgICByZXR1cm4gczNDbGllbnQuZ2V0QnVja2V0TG9nZ2luZyh7IEJ1Y2tldDogYnVja2V0TmFtZSB9KS5wcm9taXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKGxvZ2dpbmdEYXRhID0+IHtcbiAgICAgICAgICBidWNrZXQuTG9nZ2luZ0NvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6IGxvZ2dpbmdEYXRhLkxvZ2dpbmdFbmFibGVkLlRhcmdldEJ1Y2tldCxcbiAgICAgICAgICAgIExvZ0ZpbGVQcmVmaXg6IGxvZ2dpbmdEYXRhLkxvZ2dpbmdFbmFibGVkLlRhcmdldFByZWZpeFxuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHMzQ2xpZW50XG4gICAgICAgICAgICAuZ2V0QnVja2V0Tm90aWZpY2F0aW9uKHsgQnVja2V0OiBidWNrZXROYW1lIH0pXG4gICAgICAgICAgICAucHJvbWlzZSgpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihub3RpZmljYXRpb25EYXRhID0+IHtcbiAgICAgICAgICBpZiAoT2JqZWN0LmtleXMobm90aWZpY2F0aW9uRGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYnVja2V0Lk5vdGlmaWNhdGlvbkNvbmZpZ3VyYXRpb24gPSBub3RpZmljYXRpb25EYXRhO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gczNDbGllbnRcbiAgICAgICAgICAgIC5nZXRCdWNrZXRSZXBsaWNhdGlvbih7IEJ1Y2tldDogYnVja2V0TmFtZSB9KVxuICAgICAgICAgICAgLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4ocmVwbERhdGEgPT4ge1xuICAgICAgICAgIGJ1Y2tldC5SZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb24gPSByZXBsRGF0YTtcbiAgICAgICAgICByZXR1cm4gczNDbGllbnQuZ2V0QnVja2V0VGFnZ2luZyh7IEJ1Y2tldDogYnVja2V0TmFtZSB9KS5wcm9taXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHRhZ3NEYXRhID0+IHtcbiAgICAgICAgICB0YWdzRGF0YS5UYWdTZXQuZm9yRWFjaCgodGFnOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGJ1Y2tldC5UYWdzLmFkZCh0YWcpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBzM0NsaWVudC5nZXRCdWNrZXRXZWJzaXRlKHsgQnVja2V0OiBidWNrZXROYW1lIH0pLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGUgPT4ge1xuICAgICAgICAgIC8vIFNpbGVudGx5IGNhdGNoIHRoZSBOb1N1Y2hUYWdTZXRcbiAgICAgICAgICByZXR1cm4gczNDbGllbnQuZ2V0QnVja2V0V2Vic2l0ZSh7IEJ1Y2tldDogYnVja2V0TmFtZSB9KS5wcm9taXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHdlYnNpdGVEYXRhID0+IHtcbiAgICAgICAgICBidWNrZXQuV2Vic2l0ZUNvbmZpZ3VyYXRpb24gPSBuZXcgd2Vic2l0ZURhdGEoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGUgPT4ge1xuICAgICAgICAgIC8vIFNpbGVudGx5IGNhdGNoIHRoZSBOb1N1Y2hXZWJzaXRlQ29uZmlndXJhdGlvblxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoczNTZXJ2aWNlLkJ1Y2tldChsb2dpY2FsTmFtZSwgYnVja2V0KSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlID0+IHtcbiAgICAgICAgICAvLyBTaWxlbnRseSBjYXRjaCB0aGUgTm9TdWNoV2Vic2l0ZUNvbmZpZ3VyYXRpb25cbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH0pXG4gICAgKTtcbiAgfSk7XG59XG4iXX0=