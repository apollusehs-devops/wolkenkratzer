

'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.




S3BucketTransform = S3BucketTransform;var _service = require('../service');const s3Service = (0, _service.Service)('S3');function S3BucketTransform(
bucketName,
logicalName,
awsObj)
{
  const s3Client = new awsObj.S3();
  return new Promise((resolve, reject) => {
    //let bucket = new s3Resource.Bucket(newName);
    const bucket = {};
    return (
      s3Client.
      getBucketVersioning({ Bucket: bucketName }).
      promise().
      then(versionData => {
        if (Object.keys(versionData)) {
          bucket.VersioningConfiguration = versionData;
        }
        // return s3Client.getBucketAcl({ Bucket: bucketName }).promise()
        return s3Client.getBucketCors({ Bucket: bucketName }).promise();
      })
      /* .then(function (aclData) {
         console.log('2')
         console.log(JSON.stringify(aclData))
         bucket.AccessControl = aclData
         })*/.
      then(corsData => {
        console.log('cors');
        bucket.CorsConfiguration = corsData;
        return s3Client.
        getBucketLifecycleConfiguration({ Bucket: bucketName }).
        promise();
      }).
      catch(e => {
        // Silently catch the NoSuchCORSConfiguration
        return s3Client.
        getBucketLifecycleConfiguration({ Bucket: bucketName }).
        promise();
      }).
      then(lifeData => {
        console.log('life');
        bucket.LifecycleConfiguration = lifeData;
        return s3Client.getBucketLogging({ Bucket: bucketName }).promise();
      }).
      catch(e => {
        // Silently catch the NoSuchLifecycleConfiguration
        return s3Client.getBucketLogging({ Bucket: bucketName }).promise();
      }).
      then(loggingData => {
        bucket.LoggingConfiguration = {
          DestinationBucketName: loggingData.LoggingEnabled.TargetBucket,
          LogFilePrefix: loggingData.LoggingEnabled.TargetPrefix };

        return s3Client.
        getBucketNotification({ Bucket: bucketName }).
        promise();
      }).
      then(notificationData => {
        if (Object.keys(notificationData).length > 0) {
          bucket.NotificationConfiguration = notificationData;
        }
        return s3Client.
        getBucketReplication({ Bucket: bucketName }).
        promise();
      }).
      then(replData => {
        bucket.ReplicationConfiguration = replData;
        return s3Client.getBucketTagging({ Bucket: bucketName }).promise();
      }).
      then(tagsData => {
        tagsData.TagSet.forEach(tag => {
          bucket.Tags.add(tag);
        });
        return s3Client.getBucketWebsite({ Bucket: bucketName }).promise();
      }).
      catch(e => {
        // Silently catch the NoSuchTagSet
        return s3Client.getBucketWebsite({ Bucket: bucketName }).promise();
      }).
      then(websiteData => {
        bucket.WebsiteConfiguration = new websiteData();
      }).
      catch(e => {
        // Silently catch the NoSuchWebsiteConfiguration
        return;
      }).
      then(() => {
        resolve(s3Service.Bucket(logicalName, bucket));
      }).
      catch(e => {
        // Silently catch the NoSuchWebsiteConfiguration
        reject(e);
      }));

  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90cmFuc2Zvcm0vczMuanMiXSwibmFtZXMiOlsiUzNCdWNrZXRUcmFuc2Zvcm0iLCJzM1NlcnZpY2UiLCJidWNrZXROYW1lIiwibG9naWNhbE5hbWUiLCJhd3NPYmoiLCJzM0NsaWVudCIsIlMzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJidWNrZXQiLCJnZXRCdWNrZXRWZXJzaW9uaW5nIiwiQnVja2V0IiwicHJvbWlzZSIsInRoZW4iLCJ2ZXJzaW9uRGF0YSIsIk9iamVjdCIsImtleXMiLCJWZXJzaW9uaW5nQ29uZmlndXJhdGlvbiIsImdldEJ1Y2tldENvcnMiLCJjb3JzRGF0YSIsImNvbnNvbGUiLCJsb2ciLCJDb3JzQ29uZmlndXJhdGlvbiIsImdldEJ1Y2tldExpZmVjeWNsZUNvbmZpZ3VyYXRpb24iLCJjYXRjaCIsImUiLCJsaWZlRGF0YSIsIkxpZmVjeWNsZUNvbmZpZ3VyYXRpb24iLCJnZXRCdWNrZXRMb2dnaW5nIiwibG9nZ2luZ0RhdGEiLCJMb2dnaW5nQ29uZmlndXJhdGlvbiIsIkRlc3RpbmF0aW9uQnVja2V0TmFtZSIsIkxvZ2dpbmdFbmFibGVkIiwiVGFyZ2V0QnVja2V0IiwiTG9nRmlsZVByZWZpeCIsIlRhcmdldFByZWZpeCIsImdldEJ1Y2tldE5vdGlmaWNhdGlvbiIsIm5vdGlmaWNhdGlvbkRhdGEiLCJsZW5ndGgiLCJOb3RpZmljYXRpb25Db25maWd1cmF0aW9uIiwiZ2V0QnVja2V0UmVwbGljYXRpb24iLCJyZXBsRGF0YSIsIlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbiIsImdldEJ1Y2tldFRhZ2dpbmciLCJ0YWdzRGF0YSIsIlRhZ1NldCIsImZvckVhY2giLCJ0YWciLCJUYWdzIiwiYWRkIiwiZ2V0QnVja2V0V2Vic2l0ZSIsIndlYnNpdGVEYXRhIiwiV2Vic2l0ZUNvbmZpZ3VyYXRpb24iXSwibWFwcGluZ3MiOiI7O0FBRUEsYTs7Ozs7QUFLZ0JBLGlCLEdBQUFBLGlCLENBSmhCLHFDQUVBLE1BQU1DLFlBQWlCLHNCQUFRLElBQVIsQ0FBdkIsQ0FFTyxTQUFTRCxpQkFBVDtBQUNMRSxVQURLO0FBRUxDLFdBRks7QUFHTEMsTUFISztBQUlMO0FBQ0EsUUFBTUMsV0FBVyxJQUFJRCxPQUFPRSxFQUFYLEVBQWpCO0FBQ0EsU0FBTyxJQUFJQyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3RDO0FBQ0EsVUFBTUMsU0FBYyxFQUFwQjtBQUNBO0FBQ0VMO0FBQ0dNLHlCQURILENBQ3VCLEVBQUVDLFFBQVFWLFVBQVYsRUFEdkI7QUFFR1csYUFGSDtBQUdHQyxVQUhILENBR1FDLGVBQWU7QUFDbkIsWUFBSUMsT0FBT0MsSUFBUCxDQUFZRixXQUFaLENBQUosRUFBOEI7QUFDNUJMLGlCQUFPUSx1QkFBUCxHQUFpQ0gsV0FBakM7QUFDRDtBQUNEO0FBQ0EsZUFBT1YsU0FBU2MsYUFBVCxDQUF1QixFQUFFUCxRQUFRVixVQUFWLEVBQXZCLEVBQStDVyxPQUEvQyxFQUFQO0FBQ0QsT0FUSDtBQVVFOzs7O2FBVkY7QUFlR0MsVUFmSCxDQWVRTSxZQUFZO0FBQ2hCQyxnQkFBUUMsR0FBUixDQUFZLE1BQVo7QUFDQVosZUFBT2EsaUJBQVAsR0FBMkJILFFBQTNCO0FBQ0EsZUFBT2Y7QUFDSm1CLHVDQURJLENBQzRCLEVBQUVaLFFBQVFWLFVBQVYsRUFENUI7QUFFSlcsZUFGSSxFQUFQO0FBR0QsT0FyQkg7QUFzQkdZLFdBdEJILENBc0JTQyxLQUFLO0FBQ1Y7QUFDQSxlQUFPckI7QUFDSm1CLHVDQURJLENBQzRCLEVBQUVaLFFBQVFWLFVBQVYsRUFENUI7QUFFSlcsZUFGSSxFQUFQO0FBR0QsT0EzQkg7QUE0QkdDLFVBNUJILENBNEJRYSxZQUFZO0FBQ2hCTixnQkFBUUMsR0FBUixDQUFZLE1BQVo7QUFDQVosZUFBT2tCLHNCQUFQLEdBQWdDRCxRQUFoQztBQUNBLGVBQU90QixTQUFTd0IsZ0JBQVQsQ0FBMEIsRUFBRWpCLFFBQVFWLFVBQVYsRUFBMUIsRUFBa0RXLE9BQWxELEVBQVA7QUFDRCxPQWhDSDtBQWlDR1ksV0FqQ0gsQ0FpQ1NDLEtBQUs7QUFDVjtBQUNBLGVBQU9yQixTQUFTd0IsZ0JBQVQsQ0FBMEIsRUFBRWpCLFFBQVFWLFVBQVYsRUFBMUIsRUFBa0RXLE9BQWxELEVBQVA7QUFDRCxPQXBDSDtBQXFDR0MsVUFyQ0gsQ0FxQ1FnQixlQUFlO0FBQ25CcEIsZUFBT3FCLG9CQUFQLEdBQThCO0FBQzVCQyxpQ0FBdUJGLFlBQVlHLGNBQVosQ0FBMkJDLFlBRHRCO0FBRTVCQyx5QkFBZUwsWUFBWUcsY0FBWixDQUEyQkcsWUFGZCxFQUE5Qjs7QUFJQSxlQUFPL0I7QUFDSmdDLDZCQURJLENBQ2tCLEVBQUV6QixRQUFRVixVQUFWLEVBRGxCO0FBRUpXLGVBRkksRUFBUDtBQUdELE9BN0NIO0FBOENHQyxVQTlDSCxDQThDUXdCLG9CQUFvQjtBQUN4QixZQUFJdEIsT0FBT0MsSUFBUCxDQUFZcUIsZ0JBQVosRUFBOEJDLE1BQTlCLEdBQXVDLENBQTNDLEVBQThDO0FBQzVDN0IsaUJBQU84Qix5QkFBUCxHQUFtQ0YsZ0JBQW5DO0FBQ0Q7QUFDRCxlQUFPakM7QUFDSm9DLDRCQURJLENBQ2lCLEVBQUU3QixRQUFRVixVQUFWLEVBRGpCO0FBRUpXLGVBRkksRUFBUDtBQUdELE9BckRIO0FBc0RHQyxVQXRESCxDQXNEUTRCLFlBQVk7QUFDaEJoQyxlQUFPaUMsd0JBQVAsR0FBa0NELFFBQWxDO0FBQ0EsZUFBT3JDLFNBQVN1QyxnQkFBVCxDQUEwQixFQUFFaEMsUUFBUVYsVUFBVixFQUExQixFQUFrRFcsT0FBbEQsRUFBUDtBQUNELE9BekRIO0FBMERHQyxVQTFESCxDQTBEUStCLFlBQVk7QUFDaEJBLGlCQUFTQyxNQUFULENBQWdCQyxPQUFoQixDQUF5QkMsR0FBRCxJQUFjO0FBQ3BDdEMsaUJBQU91QyxJQUFQLENBQVlDLEdBQVosQ0FBZ0JGLEdBQWhCO0FBQ0QsU0FGRDtBQUdBLGVBQU8zQyxTQUFTOEMsZ0JBQVQsQ0FBMEIsRUFBRXZDLFFBQVFWLFVBQVYsRUFBMUIsRUFBa0RXLE9BQWxELEVBQVA7QUFDRCxPQS9ESDtBQWdFR1ksV0FoRUgsQ0FnRVNDLEtBQUs7QUFDVjtBQUNBLGVBQU9yQixTQUFTOEMsZ0JBQVQsQ0FBMEIsRUFBRXZDLFFBQVFWLFVBQVYsRUFBMUIsRUFBa0RXLE9BQWxELEVBQVA7QUFDRCxPQW5FSDtBQW9FR0MsVUFwRUgsQ0FvRVFzQyxlQUFlO0FBQ25CMUMsZUFBTzJDLG9CQUFQLEdBQThCLElBQUlELFdBQUosRUFBOUI7QUFDRCxPQXRFSDtBQXVFRzNCLFdBdkVILENBdUVTQyxLQUFLO0FBQ1Y7QUFDQTtBQUNELE9BMUVIO0FBMkVHWixVQTNFSCxDQTJFUSxNQUFNO0FBQ1ZOLGdCQUFRUCxVQUFVVyxNQUFWLENBQWlCVCxXQUFqQixFQUE4Qk8sTUFBOUIsQ0FBUjtBQUNELE9BN0VIO0FBOEVHZSxXQTlFSCxDQThFU0MsS0FBSztBQUNWO0FBQ0FqQixlQUFPaUIsQ0FBUDtBQUNELE9BakZILENBREY7O0FBb0ZELEdBdkZNLENBQVA7QUF3RkQiLCJmaWxlIjoiczMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG4ndXNlIHN0cmljdCc7XG5pbXBvcnQgeyBTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZSc7XG5cbmNvbnN0IHMzU2VydmljZTogYW55ID0gU2VydmljZSgnUzMnKTtcblxuZXhwb3J0IGZ1bmN0aW9uIFMzQnVja2V0VHJhbnNmb3JtKFxuICBidWNrZXROYW1lOiBzdHJpbmcsXG4gIGxvZ2ljYWxOYW1lOiBzdHJpbmcsXG4gIGF3c09iajogYW55XG4pIHtcbiAgY29uc3QgczNDbGllbnQgPSBuZXcgYXdzT2JqLlMzKCk7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgLy9sZXQgYnVja2V0ID0gbmV3IHMzUmVzb3VyY2UuQnVja2V0KG5ld05hbWUpO1xuICAgIGNvbnN0IGJ1Y2tldDogYW55ID0ge307XG4gICAgcmV0dXJuIChcbiAgICAgIHMzQ2xpZW50XG4gICAgICAgIC5nZXRCdWNrZXRWZXJzaW9uaW5nKHsgQnVja2V0OiBidWNrZXROYW1lIH0pXG4gICAgICAgIC5wcm9taXNlKClcbiAgICAgICAgLnRoZW4odmVyc2lvbkRhdGEgPT4ge1xuICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh2ZXJzaW9uRGF0YSkpIHtcbiAgICAgICAgICAgIGJ1Y2tldC5WZXJzaW9uaW5nQ29uZmlndXJhdGlvbiA9IHZlcnNpb25EYXRhO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyByZXR1cm4gczNDbGllbnQuZ2V0QnVja2V0QWNsKHsgQnVja2V0OiBidWNrZXROYW1lIH0pLnByb21pc2UoKVxuICAgICAgICAgIHJldHVybiBzM0NsaWVudC5nZXRCdWNrZXRDb3JzKHsgQnVja2V0OiBidWNrZXROYW1lIH0pLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLyogLnRoZW4oZnVuY3Rpb24gKGFjbERhdGEpIHtcbiAgICAgIGNvbnNvbGUubG9nKCcyJylcbiAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGFjbERhdGEpKVxuICAgICAgYnVja2V0LkFjY2Vzc0NvbnRyb2wgPSBhY2xEYXRhXG4gICAgfSkqL1xuICAgICAgICAudGhlbihjb3JzRGF0YSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2NvcnMnKTtcbiAgICAgICAgICBidWNrZXQuQ29yc0NvbmZpZ3VyYXRpb24gPSBjb3JzRGF0YTtcbiAgICAgICAgICByZXR1cm4gczNDbGllbnRcbiAgICAgICAgICAgIC5nZXRCdWNrZXRMaWZlY3ljbGVDb25maWd1cmF0aW9uKHsgQnVja2V0OiBidWNrZXROYW1lIH0pXG4gICAgICAgICAgICAucHJvbWlzZSgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgLy8gU2lsZW50bHkgY2F0Y2ggdGhlIE5vU3VjaENPUlNDb25maWd1cmF0aW9uXG4gICAgICAgICAgcmV0dXJuIHMzQ2xpZW50XG4gICAgICAgICAgICAuZ2V0QnVja2V0TGlmZWN5Y2xlQ29uZmlndXJhdGlvbih7IEJ1Y2tldDogYnVja2V0TmFtZSB9KVxuICAgICAgICAgICAgLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4obGlmZURhdGEgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdsaWZlJyk7XG4gICAgICAgICAgYnVja2V0LkxpZmVjeWNsZUNvbmZpZ3VyYXRpb24gPSBsaWZlRGF0YTtcbiAgICAgICAgICByZXR1cm4gczNDbGllbnQuZ2V0QnVja2V0TG9nZ2luZyh7IEJ1Y2tldDogYnVja2V0TmFtZSB9KS5wcm9taXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlID0+IHtcbiAgICAgICAgICAvLyBTaWxlbnRseSBjYXRjaCB0aGUgTm9TdWNoTGlmZWN5Y2xlQ29uZmlndXJhdGlvblxuICAgICAgICAgIHJldHVybiBzM0NsaWVudC5nZXRCdWNrZXRMb2dnaW5nKHsgQnVja2V0OiBidWNrZXROYW1lIH0pLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4obG9nZ2luZ0RhdGEgPT4ge1xuICAgICAgICAgIGJ1Y2tldC5Mb2dnaW5nQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogbG9nZ2luZ0RhdGEuTG9nZ2luZ0VuYWJsZWQuVGFyZ2V0QnVja2V0LFxuICAgICAgICAgICAgTG9nRmlsZVByZWZpeDogbG9nZ2luZ0RhdGEuTG9nZ2luZ0VuYWJsZWQuVGFyZ2V0UHJlZml4XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gczNDbGllbnRcbiAgICAgICAgICAgIC5nZXRCdWNrZXROb3RpZmljYXRpb24oeyBCdWNrZXQ6IGJ1Y2tldE5hbWUgfSlcbiAgICAgICAgICAgIC5wcm9taXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKG5vdGlmaWNhdGlvbkRhdGEgPT4ge1xuICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhub3RpZmljYXRpb25EYXRhKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBidWNrZXQuTm90aWZpY2F0aW9uQ29uZmlndXJhdGlvbiA9IG5vdGlmaWNhdGlvbkRhdGE7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBzM0NsaWVudFxuICAgICAgICAgICAgLmdldEJ1Y2tldFJlcGxpY2F0aW9uKHsgQnVja2V0OiBidWNrZXROYW1lIH0pXG4gICAgICAgICAgICAucHJvbWlzZSgpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihyZXBsRGF0YSA9PiB7XG4gICAgICAgICAgYnVja2V0LlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbiA9IHJlcGxEYXRhO1xuICAgICAgICAgIHJldHVybiBzM0NsaWVudC5nZXRCdWNrZXRUYWdnaW5nKHsgQnVja2V0OiBidWNrZXROYW1lIH0pLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4odGFnc0RhdGEgPT4ge1xuICAgICAgICAgIHRhZ3NEYXRhLlRhZ1NldC5mb3JFYWNoKCh0YWc6IGFueSkgPT4ge1xuICAgICAgICAgICAgYnVja2V0LlRhZ3MuYWRkKHRhZyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHMzQ2xpZW50LmdldEJ1Y2tldFdlYnNpdGUoeyBCdWNrZXQ6IGJ1Y2tldE5hbWUgfSkucHJvbWlzZSgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgLy8gU2lsZW50bHkgY2F0Y2ggdGhlIE5vU3VjaFRhZ1NldFxuICAgICAgICAgIHJldHVybiBzM0NsaWVudC5nZXRCdWNrZXRXZWJzaXRlKHsgQnVja2V0OiBidWNrZXROYW1lIH0pLnByb21pc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4od2Vic2l0ZURhdGEgPT4ge1xuICAgICAgICAgIGJ1Y2tldC5XZWJzaXRlQ29uZmlndXJhdGlvbiA9IG5ldyB3ZWJzaXRlRGF0YSgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgLy8gU2lsZW50bHkgY2F0Y2ggdGhlIE5vU3VjaFdlYnNpdGVDb25maWd1cmF0aW9uXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZShzM1NlcnZpY2UuQnVja2V0KGxvZ2ljYWxOYW1lLCBidWNrZXQpKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGUgPT4ge1xuICAgICAgICAgIC8vIFNpbGVudGx5IGNhdGNoIHRoZSBOb1N1Y2hXZWJzaXRlQ29uZmlndXJhdGlvblxuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSlcbiAgICApO1xuICB9KTtcbn1cbiJdfQ==