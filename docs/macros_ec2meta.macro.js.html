<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: macros/ec2meta.macro.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: macros/ec2meta.macro.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by arming on 9/25/16.
 */
'use strict'

const instanceTypes = require('../ec2info/www/instances.json')
const Promise = require('bluebird')

/** @module Macro */

/**
 * Returns an array of all instance types and details.
 * @memberof module:Macro
 * @returns {Array}
 */
function getInstanceTypeList () {
  return instanceTypes
}

/**
 * Returns an array of just the instance type names available in AWS.
 * @memberof module:Macro
 * @returns {Array}
 */
function getInstanceTypeNameList () {
  let results = []
  instanceTypes.forEach((instanceType) => {
    results.push(instanceType.instance_type)
  })
  return results
}

/**
 * Returns a map of all instance types and details.
 * @memberof module:Macro
 * @returns {{}}
 */
function getInstanceTypeMap () {
  let results = {}
  instanceTypes.forEach((instanceType) => {
    results[instanceType.instance_type] = instanceType
  })
  return results
}

/**
 * Returns an array of the names of all regions in AWS.
 * @memberof module:Macro
 * @returns {string[]}
 */
function getRegions () {
  return [ 'us-east-1', 'us-west-2', 'us-west-1', 'eu-west-1', 'eu-central-1', 'ap-southeast-1', 'ap-northeast-1', 'ap-northeast-2', 'ap-southeast-2', 'sa-east-1', 'cn-north-1', 'us-gov-west-1' ]
}

/**
 * Returns an AMI Map that can be added to a Mapping.
 * @memberof module:Macro
 * @param filters
 * @param regions
 * @returns {Promise.&lt;TResult>}
 */
function getAMIMap (filters, regions) {
  const aws = require('aws-sdk')
  return Promise.map(regions, (region) => {
    let ec2Client = new aws.EC2({ region: region })
    return Promise.map(filters, (filterSet) => {
      return ec2Client.describeImages({
        Filters: filterSet.Filters
      }).promise()
      .then((ami) => {
        let set = {}
        if (ami.Images[0]) {
          if (ami.Images[0].ImageId) {
            set[filterSet.Name] = ami.Images[0].ImageId
          } else {
            set[filterSet.Name] = 'NOT_SUPPORTED'
          }
        } else {
          set[filterSet.Name] = 'NOT_SUPPORTED'
        }
        return set
      })
    })
    .then((results) => {
      results = results.reduce((prev, current) => {
        let key = Object.keys(current)[0]
        prev[key] = current[key]
        return prev
      }, {})
      return { region: region, images: results }
    })
  })
  .then(function (results) {
    let final = {}
    results.forEach((result) => {
      final[result.region] = result.images
    })
    return final
  })
}

module.exports = {
  getInstanceTypeList: getInstanceTypeList,
  getInstanceTypeNameList: getInstanceTypeNameList,
  getInstanceTypeMap: getInstanceTypeMap,
  getRegions: getRegions,
  getAMIMap: getAMIMap
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Core.html">Core</a></li><li><a href="module-Macro.html">Macro</a></li></ul><h3>Classes</h3><ul><li><a href="module-Macro.Bucket.html">Bucket</a></li></ul><h3>Global</h3><ul><li><a href="global.html#chai">chai</a></li><li><a href="global.html#wk">wk</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sat Dec 17 2016 18:34:20 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
