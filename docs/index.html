<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>wolkenkratzer</h1><p>Wolkenkratzer is a Javascript library that helps you programmatically generate CloudFormation templates.</p>
<h1>Table of Contents</h1><ul>
<li><a href="#wolkenkratzer">wolkenkratzer</a></li>
<li><a href="#table-of-contents">Table of Contents</a><ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#general">General</a></li>
<li><a href="#resources">Resources</a><ul>
<li><a href="#constructor-name-properties">constructor (name, properties)</a></li>
<li><a href="#resource-support">Resource support</a></li>
</ul>
</li>
<li><a href="#macros">Macros</a><ul>
<li><a href="#s3-macros">S3 Macros</a><ul>
<li><a href="#s3-bucket-macro">S3 Bucket Macro</a></li>
</ul>
</li>
<li><a href="#ec2-meta-macros">EC2 Meta Macros</a><ul>
<li><a href="#getinstancetypelist">getInstanceTypeList</a></li>
<li><a href="#getinstancetypenamelist">getInstanceTypeNameList</a></li>
<li><a href="#getinstancetypemap">getInstanceTypeMap</a></li>
<li><a href="#getregions">getRegions</a></li>
<li><a href="#getamimap">getAMIMap</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#intrinsic-functions">Intrinsic Functions</a></li>
<li><a href="#parameters">Parameters</a><ul>
<li><a href="#constructor">constructor</a></li>
</ul>
</li>
<li><a href="#mappings">Mappings</a><ul>
<li><a href="#constructor-1">constructor</a></li>
</ul>
</li>
<li><a href="#output">Output</a><ul>
<li><a href="#constructor-2">constructor</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a><ul>
<li><a href="#s3-cloudfront-template-example">S3 CloudFront template example</a></li>
<li><a href="#wordpress-single-instance-site">Wordpress single instance site</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
</li>
</ul>
<h2>Installation</h2><p>  <code>$ npm install wolkenkratzer</code></p>
<p>  It can then be used in any nodejs script with</p>
<p>  <code>javascript const wk = require('wolkenkratzer')</code></p>
<h2>Usage</h2><p>Full documentation for the project can be found at https://arminhammer.github.io/wolkenkratzer/.</p>
<h3>General</h3><p>The core class is Template, which is instantiated with <code>new wolkenkratzer.Template()</code>. Parameters can be added with the <code>add()</code> method,
and Resources can be added with <code>add</code>. The final template can be retrieved with Template.toJson().</p>
<p>Template.toJson() returns an object <code>json { Errors: [], Template: {} }</code>. Any validation errors found in the Template will be added to the Errors array. If there are no validation errors, Errors will be <code>null</code>. <code>Template</code> is the JSON template.</p>
<p>The following script adds a VPNGateway to the template:</p>
<pre class="prettyprint source lang-javascript"><code>const wk = require('wolkenkratzer')

let t = new wk.Template()

let vpcCiderParam = new wk.Parameter('VPCCIDR', { Type: 'String', Default: '10.0.0.0/16' })
t.add(vpcCiderParam)

let vpnGateway = new wk.EC2.VPNGateway('VPNGateway')
vpnGateway.Type = 'ipsec.1'
t.add(vpnGateway)

console.log(t.toJson().Template)</code></pre><p>This results in the template:</p>
<pre class="prettyprint source lang-json"><code>{
  &quot;Parameters&quot;: {
    &quot;VPCCIDR&quot;: {
      &quot;Type&quot;: &quot;String&quot;,
      &quot;Default&quot;: &quot;10.0.0.0/16&quot;
    }
  },
  &quot;Resources&quot;: {
    &quot;VPNGateway&quot;: {
      &quot;Type&quot;: &quot;AWS::EC2::VPNGateway&quot;,
      &quot;Properties&quot;: {
        &quot;Type&quot;: &quot;ipsec.1&quot;
      }
    }
  },
  &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;
}</code></pre><p>YAML output is also supported:</p>
<pre class="prettyprint source lang-javascript"><code>let yamlResult = t.toYaml()

if (yamlResult.Errors) {
  console.log(yamlResult.Errors)
}
console.log(yamlResult.Template)</code></pre><p>Output:</p>
<pre class="prettyprint source lang-yaml"><code>Parameters:
  VPCCIDR:
    Type: String
    Default: 10.0.0.0/16
Resources:
  VPNGateway:
    Type: 'AWS::EC2::VPNGateway'
    Properties:
      Type: ipsec.1
AWSTemplateFormatVersion: '2010-09-09'</code></pre><h3>Resources</h3><h4>constructor (name, properties)</h4><p>Resources must be created with a string name parameter, which will be the CloudFormation logical id for the resource:</p>
<pre class="prettyprint source lang-javascript"><code>let ec2One = new wk.EC2.Instance('ec2One')</code></pre><p>Once you create the resource, you can set the attributes using setters. Although you can use the = operator to set new values, wolkenkratzer
 overrides the setters and does typechecking for you.</p>
<pre class="prettyprint source lang-javascript"><code>ec2One.ImageId = 'ami-2a69aa47'</code></pre><p>You can use the second parameter in case you want to create the resource with a JSON block, instead of setting the attributes one at a time.</p>
<p>An example of creating a resource with one argument (ec2One), and another (ec2Two) with a JSON object:</p>
<pre class="prettyprint source lang-javascript"><code>'use strict';

const aws = require('aws-sdk')
const EC2 = new aws.EC2({ region: 'us-east-1' })
const wk = require('wolkenkratzer')

let t = new wk.Template()

let ec2One = new wk.EC2.Instance('ec2One')
ec2One.ImageId = 'ami-2a69aa47'

t.add(ec2One)

EC2.describeInstances({}, (err, data) => {
  if(err) {
    console.log(err)
  } else {
    let instance = data.Reservations[0].Instances[0]
    let ec2Two = new wk.EC2.Instance('ec2Two', instance)
    t.add(ec2Two)
    console.log(t.toJson().Template)
  }
})</code></pre><p>Output:</p>
<pre class="prettyprint source lang-json"><code>{
  &quot;Resources&quot;: {
    &quot;ec2One&quot;: {
      &quot;Type&quot;: &quot;AWS::EC2::Instance&quot;,
      &quot;Properties&quot;: {
        &quot;ImageId&quot;: &quot;ami-5679aa47&quot;
      }
    },
    &quot;ec2Two&quot;: {
      &quot;Type&quot;: &quot;AWS::EC2::Instance&quot;,
      &quot;Properties&quot;: {
        &quot;EbsOptimized&quot;: false,
        &quot;ImageId&quot;: &quot;ami-466da12b&quot;,
        &quot;InstanceType&quot;: &quot;t2.micro&quot;,
        &quot;KeyName&quot;: &quot;keypair&quot;,
        &quot;PrivateIpAddress&quot;: &quot;172.31.0.119&quot;,
        &quot;SecurityGroups&quot;: [
          {
            &quot;GroupName&quot;: &quot;awseb-e-qyaht32vin-stack-AWSEBSecurityGroup-12345678&quot;,
            &quot;GroupId&quot;: &quot;sg-aba882d0&quot;
          }
        ],
        &quot;SourceDestCheck&quot;: true,
        &quot;SubnetId&quot;: &quot;subnet-bc1d1234&quot;
      }
    }
  },
  &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;
}</code></pre><h4>Resource support</h4><p>Wolkenkratzer supports all CloudFormation resources. This is made possible by scripts that scrape the CloudFormation documentation pages 
and generate the resource code files. The scrapers can be found in the /scripts folder.</p>
<h3>Macros</h3><p>Wolkenkratzer includes macros that take advantage of the aws-sdk npm library. The macros are intended to make certain common uses of CloudFormation easier. </p>
<h4>S3 Macros</h4><h5>S3 Bucket Macro</h5><p>Currently the S3 Bucket is the only macro for Resources, which can be used like this:</p>
<pre class="prettyprint source lang-javascript"><code>'use strict'

let region = 'us-east-1'
const wk = require('wolkenkratzer')
const aws = require('aws-sdk')
const s3 = new aws.S3({ region: region })

s3.listBuckets().promise()
.then((data) => {
  let bucketName = data.Buckets[0].Name
  return wk.Macro.S3.Bucket(bucketName, 'mybucket', region)
})
.then((bucket) => {
  let t = new wk.Template()
  t.add(bucket)
  let result = t.toJson()
  console.log(result.Template)
})
.catch((e) => {
  console.error(e)
})</code></pre><p>Output: </p>
<pre class="prettyprint source lang-json"><code>{
  &quot;Resources&quot;: {
    &quot;mybucket&quot;: {
      &quot;Type&quot;: &quot;AWS::S3::Bucket&quot;,
      &quot;Properties&quot;: {
        &quot;BucketName&quot;: &quot;mybucket&quot;,
        &quot;LifecycleConfiguration&quot;: {
          &quot;Rules&quot;: [
            {
              &quot;ID&quot;: &quot;rule0&quot;,
              &quot;Prefix&quot;: &quot;&quot;,
              &quot;Status&quot;: &quot;Enabled&quot;,
              &quot;Transitions&quot;: [
                {
                  &quot;Days&quot;: 180,
                  &quot;StorageClass&quot;: &quot;STANDARD_IA&quot;
                }
              ],
              &quot;NoncurrentVersionTransitions&quot;: []
            }
          ]
        },
        &quot;LoggingConfiguration&quot;: {
          &quot;LoggingEnabled&quot;: {
            &quot;TargetBucket&quot;: &quot;my-logging-bucket&quot;,
            &quot;TargetGrants&quot;: [],
            &quot;TargetPrefix&quot;: &quot;logs/&quot;
          }
        },
        &quot;NotificationConfiguration&quot;: {
          &quot;CloudFunctionConfiguration&quot;: {
            &quot;Id&quot;: &quot;Lambda&quot;,
            &quot;Event&quot;: &quot;s3:ObjectCreated:*&quot;,
            &quot;Events&quot;: [
              &quot;s3:ObjectCreated:*&quot;
            ],
            &quot;CloudFunction&quot;: &quot;arn:aws:lambda:us-east-1:2123456789:function:myFunc&quot;
          }
        },
        &quot;ReplicationConfiguration&quot;: {
          &quot;ReplicationConfiguration&quot;: {
            &quot;Role&quot;: &quot;arn:aws:iam::2123456789:role/my-role-s3-repl-role&quot;,
            &quot;Rules&quot;: [
              {
                &quot;ID&quot;: &quot;mybucket&quot;,
                &quot;Prefix&quot;: &quot;&quot;,
                &quot;Status&quot;: &quot;Enabled&quot;,
                &quot;Destination&quot;: {
                  &quot;Bucket&quot;: &quot;arn:aws:s3:::replbucket&quot;
                }
              }
            ]
          }
        },
        &quot;Tags&quot;: [
          {
            &quot;Key&quot;: &quot;testkey&quot;,
            &quot;Value&quot;: &quot;testvalue&quot;
          }
        ],
        &quot;VersioningConfiguration&quot;: {
          &quot;Status&quot;: &quot;Enabled&quot;
        },
        &quot;WebsiteConfiguration&quot;: {
          &quot;ErrorDocument&quot;: {
            &quot;Key&quot;: &quot;error.html&quot;
          },
          &quot;IndexDocument&quot;: {
            &quot;Suffix&quot;: &quot;index.html&quot;
          },
          &quot;RoutingRules&quot;: []
        }
      }
    }
  },
  &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;
}</code></pre><h4>EC2 Meta Macros</h4><p>The EC2 Meta macros take advantage of the scraped data from the excellent https://github.com/powdahound/ec2instances.info project. A cached version of https://github.com/powdahound/ec2instances.info/blob/master/www/instances.json is stored in metadata/ec2info.json.</p>
<h5>getInstanceTypeList</h5><p>Returns an array of instance types and details.</p>
<pre class="prettyprint source lang-javascript"><code>const instanceList = wk.Macro.EC2Meta.getInstanceTypeList()</code></pre><h5>getInstanceTypeNameList</h5><p>Returns an array of just the names of instance types.</p>
<pre class="prettyprint source lang-javascript"><code>const instanceTypes = wk.Macro.EC2Meta.getInstanceTypeNameList()</code></pre><h5>getInstanceTypeMap</h5><p>Same as getInstanceTypeList, but returns as an object instead of an array.</p>
<pre class="prettyprint source lang-javascript"><code>const instanceTypeMap = wk.Macro.EC2Meta.getInstanceTypeMap()</code></pre><h5>getRegions</h5><p>Returns an array of all the names of regions available in AWS.</p>
<pre class="prettyprint source lang-javascript"><code>let regions = wk.Macro.EC2Meta.getRegions().filter((region) => {
  if (!region.includes('us-gov') && !region.includes('cn-north-1')) {
    return region
  }
})
console.log(regions)</code></pre><h5>getAMIMap</h5><p>Makes a series of aws-sdk EC2.describeImages calls in order to structure a map of AMIs based off of search criteria across one or more regions. Useful when trying to maintain complicated <code>Mappings</code> of AMIs across multiple regions. Returns a <code>javascript Promise</code> so make sure you handle the result with a then() call:</p>
<pre class="prettyprint source lang-javascript"><code>let filterParams = [
  { Name: 'HVM64', Filters: [ { Name: 'name', Values: ['amzn-ami-hvm-2016.03.3.x86_64-gp2'] } ] },
  { Name: 'PV64', Filters: [ { Name: 'name', Values: ['amzn-ami-pv-2016.03.3.x86_64-ebs'] } ] },
  { Name: 'HVMG2', Filters: [ { Name: 'name', Values: ['amzn-ami-graphics-hvm-2016.03.3.x86_64*'] } ] }
]

let regions = wk.Macro.EC2Meta.getRegions().filter((region) => {
  if (!region.includes('us-gov') && !region.includes('cn-north-1')) {
    return region
  }
})

wk.Macro.EC2Meta.getAMIMap(filterParams, regions)
.then((amiMap) => {
  t.add(new wk.Mapping('AWSRegionArch2AMI', amiMap))
})
.catch((e) => {
  console.error(e)
})</code></pre><p>Outputs:</p>
<pre class="prettyprint source lang-json"><code>&quot;AWSRegionArch2AMI&quot;: {
      &quot;us-east-1&quot;: {
        &quot;HVM64&quot;: &quot;ami-6869aa05&quot;,
        &quot;PV64&quot;: &quot;ami-2a69aa47&quot;,
        &quot;HVMG2&quot;: &quot;ami-2e5e9c43&quot;
      },
      &quot;us-west-2&quot;: {
        &quot;HVM64&quot;: &quot;ami-7172b611&quot;,
        &quot;PV64&quot;: &quot;ami-7f77b31f&quot;,
        &quot;HVMG2&quot;: &quot;ami-83b770e3&quot;
      },
      &quot;us-west-1&quot;: {
        &quot;HVM64&quot;: &quot;ami-31490d51&quot;,
        &quot;PV64&quot;: &quot;ami-a2490dc2&quot;,
        &quot;HVMG2&quot;: &quot;ami-fd76329d&quot;
      },
      &quot;eu-west-1&quot;: {
        &quot;HVM64&quot;: &quot;ami-f9dd458a&quot;,
        &quot;PV64&quot;: &quot;ami-4cdd453f&quot;,
        &quot;HVMG2&quot;: &quot;ami-b9bd25ca&quot;
      },
      &quot;eu-central-1&quot;: {
        &quot;HVM64&quot;: &quot;ami-ea26ce85&quot;,
        &quot;PV64&quot;: &quot;ami-6527cf0a&quot;,
        &quot;HVMG2&quot;: &quot;ami-7f04ec10&quot;
      },
      &quot;ap-southeast-1&quot;: {
        &quot;HVM64&quot;: &quot;ami-a59b49c6&quot;,
        &quot;PV64&quot;: &quot;ami-df9e4cbc&quot;,
        &quot;HVMG2&quot;: &quot;ami-0cb5676f&quot;
      },
      &quot;ap-northeast-1&quot;: {
        &quot;HVM64&quot;: &quot;ami-374db956&quot;,
        &quot;PV64&quot;: &quot;ami-3e42b65f&quot;,
        &quot;HVMG2&quot;: &quot;ami-e0ee1981&quot;
      },
      &quot;ap-northeast-2&quot;: {
        &quot;HVM64&quot;: &quot;ami-2b408b45&quot;,
        &quot;PV64&quot;: &quot;NOT_SUPPORTED&quot;,
        &quot;HVMG2&quot;: &quot;NOT_SUPPORTED&quot;
      },
      &quot;ap-southeast-2&quot;: {
        &quot;HVM64&quot;: &quot;ami-dc361ebf&quot;,
        &quot;PV64&quot;: &quot;ami-63351d00&quot;,
        &quot;HVMG2&quot;: &quot;ami-a71c34c4&quot;
      },
      &quot;sa-east-1&quot;: {
        &quot;HVM64&quot;: &quot;ami-6dd04501&quot;,
        &quot;PV64&quot;: &quot;ami-1ad34676&quot;,
        &quot;HVMG2&quot;: &quot;NOT_SUPPORTED&quot;
      }
    }</code></pre><p>Macros for other resources, as well as Mappings and other parameter blocks are planned for the future.</p>
<h3>Intrinsic Functions</h3><p>Intrinsic functions such as Ref and Fn::GetAtt are supported. Any resource can associate with other elements by using the corresponding 
intrinsic function:</p>
<pre class="prettyprint source lang-javascript"><code>const wk = require('wolkenkratzer')
const Ref = wk.Intrinsic.Ref

let t = new wk.Template()

let bucketName = new wk.Parameter('BucketName', {
  'Type': 'String'
})

let bucket = new wk.S3.Bucket('s3Bucket')
bucket.BucketName = new Ref(bucketName)
t.add(bucket)

console.log(t.toJson().Template)</code></pre><p>Intrinsic functions are available from wk.Instrinsic.*.</p>
<p>Convenience methods are available for Resources. For example, you can call .ref():</p>
<pre class="prettyprint source lang-javascript"><code>const wk = require('wolkenkratzer')

let t = new wk.Template()

let bucketName = new wk.Parameter('BucketName', {
  'Type': 'String'
})

let bucket = new wk.S3.Bucket('s3Bucket')
bucket.BucketName.ref(bucketName)
t.add(bucket)

console.log(t.toJson().Template)</code></pre><h3>Parameters</h3><p>Parameters are available at wk.Parameters.</p>
<h4>constructor</h4><p>Parameters take two parameters: the first parameter is the logical id of the Parameter, and the other is the object that represents
the attributes of the Paramter:</p>
<pre class="prettyprint source lang-javascript"><code>let t = new wk.Template()

let hostedZoneParam = new wk.Parameter('HostedZone', {
  'Type': 'String',
  'Description': 'The DNS name of an existing Amazon Route 53 hosted zone',
  'AllowedPattern': '(?!-)[a-zA-Z0-9-.]{1,63}(?&lt;!-)',
  'ConstraintDescription': 'must be a valid DNS zone name.'
})

t.add(hostedZoneParam)</code></pre><h3>Mappings</h3><p>Mappings are available at wk.Mapping.</p>
<h4>constructor</h4><p>Mappings take two parameters: the first parameter is the logical id of the Mapping, and the other is the object that represents
the attributes of the Mapping:</p>
<pre class="prettyprint source lang-javascript"><code>let region2S3WebsiteSuffixMap = new wk.Mapping('Region2S3WebsiteSuffix', {
  'us-east-1': { 'Suffix': '.s3-website-us-east-1.amazonaws.com' },
  'us-west-1': { 'Suffix': '.s3-website-us-west-1.amazonaws.com' },
  'us-west-2': { 'Suffix': '.s3-website-us-west-2.amazonaws.com' },
  'eu-west-1': { 'Suffix': '.s3-website-eu-west-1.amazonaws.com' },
  'ap-northeast-1': { 'Suffix': '.s3-website-ap-northeast-1.amazonaws.com' },
  'ap-northeast-2': { 'Suffix': '.s3-website-ap-northeast-2.amazonaws.com' },
  'ap-southeast-1': { 'Suffix': '.s3-website-ap-southeast-1.amazonaws.com' },
  'ap-southeast-2': { 'Suffix': '.s3-website-ap-southeast-2.amazonaws.com' },
  'sa-east-1': { 'Suffix': '.s3-website-sa-east-1.amazonaws.com' },
  'cn-north-1': { 'Suffix': '.s3-website.cn-north-1.amazonaws.com.cn' },
  'eu-central-1': { 'Suffix': '.s3-website-eu-central-1.amazonaws.com' }
  }
)

t.add(region2S3WebsiteSuffixMap)</code></pre><h3>Output</h3><p>Outputs are available at wk.Output.</p>
<h4>constructor</h4><p>Output take two parameters: the first parameter is the logical id of the Output, and the other is the object that represents
the attributes of the Mapping:</p>
<pre class="prettyprint source lang-javascript"><code>t.add(new wk.Output('WebsiteURL', {
  'Value': new wk.Intrinsic.FnJoin('', ['http://', new Ref(websiteDNSName)]),
  'Description': 'The URL of the newly created website'
}))</code></pre><h3>Examples</h3><p>More examples can be found in the /examples folder.</p>
<h4>S3 CloudFront template example</h4><pre class="prettyprint source lang-javascript"><code>'use strict'

const wk = require('wolkenkratzer')
const Ref = wk.Intrinsic.Ref

let t = new wk.Template()

t.setDescription('AWS CloudFormation Sample Template S3_Website_With_CloudFront_Distribution: Sample template showing how to create a website with a custom DNS name, hosted on Amazon S3 and served via Amazone CloudFront. It assumes you already have a Hosted Zone registered with Amazon Route 53. **WARNING** This template creates an Amazon Route 53 DNS record, an S3 bucket and a CloudFront distribution. You will be billed for the AWS resources used if you create a stack from this template.')

let hostedZoneParam = new wk.Parameter('HostedZone', {
  'Type': 'String',
  'Description': 'The DNS name of an existing Amazon Route 53 hosted zone',
  'AllowedPattern': '(?!-)[a-zA-Z0-9-.]{1,63}(?&lt;!-)',
  'ConstraintDescription': 'must be a valid DNS zone name.'
})

t.add(hostedZoneParam)

let region2S3WebsiteSuffixMap = new wk.Mapping('Region2S3WebsiteSuffix', {
  'us-east-1': { 'Suffix': '.s3-website-us-east-1.amazonaws.com' },
  'us-west-1': { 'Suffix': '.s3-website-us-west-1.amazonaws.com' },
  'us-west-2': { 'Suffix': '.s3-website-us-west-2.amazonaws.com' },
  'eu-west-1': { 'Suffix': '.s3-website-eu-west-1.amazonaws.com' },
  'ap-northeast-1': { 'Suffix': '.s3-website-ap-northeast-1.amazonaws.com' },
  'ap-northeast-2': { 'Suffix': '.s3-website-ap-northeast-2.amazonaws.com' },
  'ap-southeast-1': { 'Suffix': '.s3-website-ap-southeast-1.amazonaws.com' },
  'ap-southeast-2': { 'Suffix': '.s3-website-ap-southeast-2.amazonaws.com' },
  'sa-east-1': { 'Suffix': '.s3-website-sa-east-1.amazonaws.com' },
  'cn-north-1': { 'Suffix': '.s3-website.cn-north-1.amazonaws.com.cn' },
  'eu-central-1': { 'Suffix': '.s3-website-eu-central-1.amazonaws.com' }
}
)

t.add(region2S3WebsiteSuffixMap)

let s3BucketForWebsiteContent = new wk.S3.Bucket('S3BucketForWebsiteContent')
s3BucketForWebsiteContent.AccessControl = 'PublicRead'
let webConfig = new wk.Types.AmazonS3WebsiteConfigurationProperty()
webConfig.IndexDocument = 'index.html'
webConfig.ErrorDocument = 'error.html'
s3BucketForWebsiteContent.WebsiteConfiguration = webConfig

t.add(s3BucketForWebsiteContent)

let websiteDNSName = new wk.Route53.RecordSet('WebsiteDNSName')
websiteDNSName.Type = 'CNAME'
websiteDNSName.TTL = '900'
websiteDNSName.Comment = 'CNAME redirect custom name to CloudFront distribution'
websiteDNSName.Name.join('', [ new Ref(wk.Pseudo.AWS_STACK_NAME), new Ref(wk.Pseudo.AWS_ACCOUNT_ID), '.', new Ref(wk.Pseudo.AWS_REGION), '.', new Ref(hostedZoneParam) ])
websiteDNSName.ResourceRecords.push(new wk.Intrinsic.FnJoin('', [ 'http://', new wk.Intrinsic.FnGetAtt('WebsiteCDN', 'DomainName') ]))
websiteDNSName.HostedZoneName.join('', [ new Ref(hostedZoneParam), '.' ])
t.add(websiteDNSName)

let websiteCDN = new wk.CloudFront.Distribution('WebsiteCDN')

let distConfigOrigin = new wk.Types.CloudFrontDistributionConfigOrigin()
distConfigOrigin.DomainName.join('', [ new Ref(s3BucketForWebsiteContent),
  new wk.Intrinsic.FnFindInMap('Region2S3WebsiteSuffix', new Ref(wk.Pseudo.AWS_REGION), 'Suffix') ])
distConfigOrigin.Id = 'only-origin'
let customOriginConfig = new wk.Types.CloudFrontDistributionConfigOriginCustomOrigin()
customOriginConfig.HTTPPort = '80'
customOriginConfig.HTTPSPort = '443'
customOriginConfig.OriginProtocolPolicy = 'http-only'
distConfigOrigin.CustomOriginConfig = customOriginConfig

let forwardedValues = new wk.Types.CloudFrontForwardedValues()
forwardedValues.QueryString = true

let defaultCacheBehavior = new wk.Types.CloudFrontDefaultCacheBehavior()
defaultCacheBehavior.ForwardedValues = forwardedValues
defaultCacheBehavior.TargetOriginId = 'only-origin'
defaultCacheBehavior.ViewerProtocolPolicy = 'allow-all'

let distConfig = new wk.Types.CloudFrontDistributionConfig()
distConfig.Comment = 'CDN for S3-backed website'
distConfig.Aliases.push(new wk.Intrinsic.FnJoin('', [ new Ref(wk.Pseudo.AWS_STACK_NAME), new Ref(wk.Pseudo.AWS_ACCOUNT_ID), '.', new Ref(wk.Pseudo.AWS_REGION), '.', new Ref(hostedZoneParam) ]))
distConfig.Origins.push(distConfigOrigin)
distConfig.Enabled = true
distConfig.DefaultRootObject = 'index.html'
distConfig.DefaultCacheBehavior = defaultCacheBehavior

websiteCDN.DistributionConfig = distConfig

t.add(websiteCDN)

t.add(new wk.Output('WebsiteURL', {
  'Value': new wk.Intrinsic.FnJoin('', ['http://', new Ref(websiteDNSName)]),
  'Description': 'The URL of the newly created website'
}))

t.add(new wk.Output('BucketName', {
  'Value': new Ref(s3BucketForWebsiteContent),
  'Description': 'Name of S3 bucket to hold website content'
}))

console.log(t.toJson().Template)</code></pre><h4>Wordpress single instance site</h4><pre class="prettyprint source lang-javascript"><code>'use strict'

const wk = require('wolkenkratzer')

let t = new wk.Template()

t.setDescription('AWS CloudFormation Sample Template WordPress_Single_Instance: WordPress is web software you can use to create a beautiful website or blog. This template installs WordPress with a local MySQL database for storage. It demonstrates using the AWS CloudFormation bootstrap scripts to deploy WordPress. **WARNING** This template creates an Amazon EC2 instance. You will be billed for the AWS resources used if you create a stack from this template.')

let keyNameParam = new wk.Parameter('KeyName', {
  'Type': 'AWS::EC2::KeyPair::KeyName',
  'ConstraintDescription': 'must be the name of an existing EC2 KeyPair.',
  'Description': 'Name of an existing EC2 KeyPair to enable SSH access to the instances'
})
t.add(keyNameParam)

let instanceTypeParam = new wk.Parameter('InstanceType', {
  'Description': 'WebServer EC2 instance type',
  'Type': 'String',
  'Default': 't2.small',
  'AllowedValues': wk.Macro.EC2Meta.getInstanceTypeNameList(),
  'ConstraintDescription': 'must be a valid EC2 instance type.'
})
t.add(instanceTypeParam)

let sshLocationParam = new wk.Parameter('SSHLocation', {
  'Description': 'The IP address range that can be used to SSH to the EC2 instances',
  'Type': 'String',
  'MinLength': '9',
  'MaxLength': '18',
  'Default': '0.0.0.0/0',
  'AllowedPattern': '(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})',
  'ConstraintDescription': 'must be a valid IP CIDR range of the form x.x.x.x/x.'
})
t.add(sshLocationParam)

let dbNameParam = new wk.Parameter('DBName', {
  'Default': 'wordpressdb',
  'Description': 'The WordPress database name',
  'Type': 'String',
  'MinLength': '1',
  'MaxLength': '64',
  'AllowedPattern': '[a-zA-Z][a-zA-Z0-9]*',
  'ConstraintDescription': 'must begin with a letter and contain only alphanumeric characters.'
})
t.add(dbNameParam)

let dbUserParam = new wk.Parameter('DBUser', {
  'NoEcho': 'true',
  'Description': 'The WordPress database admin account username',
  'Type': 'String',
  'MinLength': '1',
  'MaxLength': '16',
  'AllowedPattern': '[a-zA-Z][a-zA-Z0-9]*',
  'ConstraintDescription': 'must begin with a letter and contain only alphanumeric characters.'
})
t.add(dbUserParam)

let dbPasswordParam = new wk.Parameter('DBPassword', {
  'NoEcho': 'true',
  'Description': 'The WordPress database admin account password',
  'Type': 'String',
  'MinLength': '8',
  'MaxLength': '41',
  'AllowedPattern': '[a-zA-Z0-9]*',
  'ConstraintDescription': 'must contain only alphanumeric characters.'
})
t.add(dbPasswordParam)

let dbRootPasswordParam = new wk.Parameter('DBRootPassword', {
  'NoEcho': 'true',
  'Description': 'MySQL root password',
  'Type': 'String',
  'MinLength': '8',
  'MaxLength': '41',
  'AllowedPattern': '[a-zA-Z0-9]*',
  'ConstraintDescription': 'must contain only alphanumeric characters.'
})
t.add(dbRootPasswordParam)

let webServerSecurityGroup = new wk.EC2.SecurityGroup('WebServerSecurityGroup')
t.add(webServerSecurityGroup)
webServerSecurityGroup.GroupDescription = 'Enable HTTP access via port 80 locked down to the load balancer + SSH access'

let rule1 = new wk.Types.EC2SecurityGroupRulePropertyType({'IpProtocol': 'tcp', 'FromPort': 80, 'ToPort': 80, 'CidrIp': '0.0.0.0/0'})
webServerSecurityGroup.SecurityGroupIngress.push(rule1)

let rule2 = new wk.Types.EC2SecurityGroupRulePropertyType()
rule2.IpProtocol = 'tcp'
rule2.FromPort = 22
rule2.ToPort = 22
rule2.CidrIp.ref(sshLocationParam)
webServerSecurityGroup.SecurityGroupIngress.push(rule2)

let AWSInstanceType2ArchMap = new wk.Mapping('AWSInstanceType2Arch', wk.Macro.EC2Meta.getInstanceTypeList().reduce((result, instanceType) => {
  let ending = '64'
  if (instanceType.linux_virtualization_types[0] && instanceType.arch.includes('x86_64')) {
    if(instanceType.instance_type.includes('g2')) {
      ending = 'G2'
    }
    result[instanceType.instance_type] = {
      Arch: instanceType.linux_virtualization_types[0] + ending
    }
  }
  return result
}, {}))
t.add(AWSInstanceType2ArchMap)

let AWSInstanceType2NATArchMap = new wk.Mapping('AWSInstanceType2NATArch', wk.Macro.EC2Meta.getInstanceTypeList().reduce((result, instanceType) => {
  let ending = '64'
  if (instanceType.linux_virtualization_types[0] && instanceType.arch.includes('x86_64')) {
    if(instanceType.instance_type.includes('g2')) {
      ending = 'G2'
    }
    result[instanceType.instance_type] = {
      Arch: 'NAT' + instanceType.linux_virtualization_types[0] + ending
    }
  }
  return result
}, {}))
t.add(AWSInstanceType2NATArchMap)

let webServer = new wk.EC2.Instance('WebServer')
webServer.ImageId.findInMap('AWSRegionArch2AMI', { 'Ref': 'AWS::Region' }, { 'Fn::FindInMap': [ 'AWSInstanceType2Arch', { 'Ref': 'InstanceType' }, 'Arch' ] })
t.add(webServer)

webServer.InstanceType.ref(instanceTypeParam)
webServer.SecurityGroups.push(new wk.Intrinsic.Ref(webServerSecurityGroup))
webServer.KeyName.ref(keyNameParam)
webServer.UserData.base64({ 'Fn::Join': ['', [
  '#!/bin/bash -xe\n',
  'yum update -y aws-cfn-bootstrap\n',

  '/opt/aws/bin/cfn-init -v ',
  '         --stack ', { 'Ref': 'AWS::StackName' },
  '         --resource WebServer ',
  '         --configsets wordpressInstall ',
  '         --region ', { 'Ref': 'AWS::Region' }, '\n',

  '/opt/aws/bin/cfn-signal -e $? ',
  '         --stack ', { 'Ref': 'AWS::StackName' },
  '         --resource WebServer ',
  '         --region ', { 'Ref': 'AWS::Region' }, '\n'
]]})

let webSiteUrlOutput = new wk.Output('WebsiteURL', {
  'Value': { 'Fn::Join': [ '', [ 'http://', { 'Fn::GetAtt': [ 'WebServer', 'PublicDnsName' ] }, '/wordpress' ] ] },
  'Description': 'WordPress Website'
})

let setMysqlRootPassword = new wk.Init.Command('01_setMysqlRootPassword')
setMysqlRootPassword.command = { 'Fn::Join': [ '', [ 'mysqladmin -u root password \'', { 'Ref': 'DBRootPassword' }, '\'' ] ] }
setMysqlRootPassword.ava = { 'Fn::Join': [ '', [ '$(mysql ', { 'Ref': 'DBName' }, ' -u root --password=\'', { 'Ref': 'DBRootPassword' }, '\' >/dev/null 2>&1 &lt;/dev/null); (( $? != 0 ))' ] ] }

let createDatabase = new wk.Init.Command('02_createDatabase')
createDatabase.command = { 'Fn::Join': [ '', [ 'mysql -u root --password=\'', { 'Ref': 'DBRootPassword' }, '\' &lt; /tmp/setup.mysql' ] ] }
createDatabase.ava = { 'Fn::Join': [ '', [ '$(mysql ', { 'Ref': 'DBName' }, ' -u root --password=\'', { 'Ref': 'DBRootPassword' }, '\' >/dev/null 2>&1 &lt;/dev/null); (( $? != 0 ))' ] ] }

let configureWordpressCMD = new wk.Init.Command('03_configureWordpress')
configureWordpressCMD.command = '/tmp/create-wp-config'
configureWordpressCMD.cwd = '/var/www/html/wordpress'

let configureWordpress = new wk.Init.Config('configureWordpress')
configureWordpress.add(setMysqlRootPassword)
configureWordpress.add(createDatabase)
configureWordpress.add(configureWordpressCMD)

webServer.addConfig(configureWordpress)

let cfnHup = new wk.Init.File('/etc/cfn/cfn-hup.conf')
cfnHup.content = { 'Fn::Join': ['', [ '[main]\n', 'stack=', { 'Ref': 'AWS::StackId' }, '\n', 'region=', { 'Ref': 'AWS::Region' }, '\n' ]] }
cfnHup.mode = '000400'
cfnHup.owner = 'root'
cfnHup.group = 'root'

let cfnAutoReloader = new wk.Init.File('/etc/cfn/hooks.d/cfn-auto-reloader.conf')
cfnAutoReloader.content = { 'Fn::Join': [ '', [ '[cfn-auto-reloader-hook]\n', 'triggers=post.update\n', 'path=Resources.WebServer.Metadata.AWS::CloudFormation::Init\n', 'action=/opt/aws/bin/cfn-init -v ', '         --stack ', { 'Ref': 'AWS::StackName' }, '         --resource WebServer ', '         --configsets wordpressInstall ', '         --region ', { 'Ref': 'AWS::Region' }, '\n' ] ] }
cfnAutoReloader.mode = '000400'
cfnAutoReloader.owner = 'root'
cfnAutoReloader.group = 'root'

let cfnHupService = new wk.Init.Service('cfn-hup')
cfnHupService.enabled = 'true'
cfnHupService.ensureRunning = 'true'
cfnHupService.files = ['/etc/cfn/cfn-hup.conf', '/etc/cfn/hooks.d/cfn-auto-reloader.conf']

let installCfn = new wk.Init.Config('installCfn')
installCfn.add(cfnHup)
installCfn.add(cfnAutoReloader)
installCfn.add(cfnHupService)
webServer.addConfig(installCfn)

let createWPConfig = new wk.Init.File('/tmp/create-wp-config')
createWPConfig.content = { 'Fn::Join': [ '', [ '#!/bin/bash -xe\n', 'cp /var/www/html/wordpress/wp-config-sample.php /var/www/html/wordpress/wp-config.php\n', 'sed -i &quot;s/\'database_name_here\'/\'', { 'Ref': 'DBName' }, '\'/g&quot; wp-config.php\n', 'sed -i &quot;s/\'username_here\'/\'', { 'Ref': 'DBUser' }, '\'/g&quot; wp-config.php\n', 'sed -i &quot;s/\'password_here\'/\'', { 'Ref': 'DBPassword' }, '\'/g&quot; wp-config.php\n' ] ] }
createWPConfig.mode = '000500'
createWPConfig.owner = 'root'
createWPConfig.group = 'root'

let setupMysql = new wk.Init.File('/tmp/setup.mysql')
setupMysql.content = { 'Fn::Join': ['', [ 'CREATE DATABASE ', { 'Ref': 'DBName' }, ';\n', 'CREATE USER \'', { 'Ref': 'DBUser' }, '\'@\'localhost\' IDENTIFIED BY \'', { 'Ref': 'DBPassword' }, '\';\n', 'GRANT ALL ON ', { 'Ref': 'DBName' }, '.* TO \'', { 'Ref': 'DBUser' }, '\'@\'localhost\';\n', 'FLUSH PRIVILEGES;\n' ]] }
setupMysql.mode = '000400'
setupMysql.owner = 'root'
setupMysql.group = 'root'

let wpPackages = new wk.Init.Packages('yum', {
  'php': [],
  'php-mysql': [],
  'mysql': [],
  'mysql-server': [],
  'mysql-devel': [],
  'mysql-libs': [],
  'httpd': []
})

let httpd = new wk.Init.Service('httpd')
httpd.enabled = 'true'
httpd.ensureRunning = 'true'

let mysqld = new wk.Init.Service('mysqld')
mysqld.enabled = 'true'
mysqld.ensureRunning = 'true'

let htmlSource = new wk.Init.Source('/var/www/html', 'http://wordpress.org/latest.tar.gz')

let installWordpress = new wk.Init.Config('installWordpress')
installWordpress.add(createWPConfig)
installWordpress.add(setupMysql)
installWordpress.add(wpPackages)
installWordpress.add(httpd)
installWordpress.add(mysqld)
installWordpress.add(htmlSource)
webServer.addConfig(installWordpress)

let wordpressInstall = new wk.Init.ConfigSet('wordpressInstall')
wordpressInstall.add(installCfn)
wordpressInstall.add(installWordpress)
wordpressInstall.add(configureWordpress)
webServer.addConfigSet(wordpressInstall)

let cPolicy = new wk.Policy.CreationPolicy({
  'ResourceSignal': {
    'Timeout': 'PT15M'
  }
})
webServer.addPolicy(cPolicy)
t.add(webSiteUrlOutput)

let filterParams = [
  { Name: 'HVM64', Filters: [ { Name: 'name', Values: ['amzn-ami-hvm-2016.03.3.x86_64-gp2'] } ] },
  { Name: 'PV64', Filters: [ { Name: 'name', Values: ['amzn-ami-pv-2016.03.3.x86_64-ebs'] } ] },
  { Name: 'HVMG2', Filters: [ { Name: 'name', Values: ['amzn-ami-graphics-hvm-2016.03.3.x86_64*'] } ] }
]

let regions = wk.Macro.EC2Meta.getRegions().filter((region) => {
  if (!region.includes('us-gov') && !region.includes('cn-north-1')) {
    return region
  }
})

wk.Macro.EC2Meta.getAMIMap(filterParams, regions)
.then((amiMap) => {
  t.add(new wk.Mapping('AWSRegionArch2AMI', amiMap))
  let result = t.toJson()
  if (result.Errors) {
    // console.error(result.Errors)
  }
  console.log(result.Template)
})
.catch((e) => {
  console.error(e)
})</code></pre><h2>Contributing</h2><p>Wolkenkratzer is still a new library and needs lots of testing. If you run into any problems please open an issue or create a PR. All 
contributions are welcome!</p>
<h2>License</h2><p>Wolkenkratzer uses the Apache 2.0 open source license.</p></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Core.html">Core</a></li><li><a href="module-Macro.html">Macro</a></li></ul><h3>Classes</h3><ul><li><a href="module-Macro.Bucket.html">Bucket</a></li></ul><h3>Global</h3><ul><li><a href="global.html#chai">chai</a></li><li><a href="global.html#wk">wk</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sat Dec 17 2016 18:34:20 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>